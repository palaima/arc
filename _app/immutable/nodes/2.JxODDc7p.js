var kt=Object.defineProperty;var yt=(l,t,e)=>t in l?kt(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var Pe=(l,t,e)=>yt(l,typeof t!="symbol"?t+"":t,e);import{s as be,n as te,d as p,r as Ke,P as ae,Q as J,e as Z,f as M,h as c,R as F,A as u,j as b,k as E,S as x,m as U,l as P,o as v,p as A,t as H,q as pe,T as Ve,U as Ne,v as Se,V as Oe,W as Et,X as Ct,c as St,u as Tt,g as Ut,b as At,Y as vt,Z as tt,C as mt,_ as Lt,$ as Dt}from"../chunks/Ct-DdQaZ.js";import{S as ve,i as me,t as ee,a as W,f as It,d as Te,c as Ge,m as Ue,e as Ae,b as Le,g as Fe}from"../chunks/DldV-x9j.js";import{w as je,d as _t}from"../chunks/Bs7vbK-S.js";function Be(l){return l?.length!==void 0?l:Array.from(l)}const Mt=!0,Pt=!1,Us=Object.freeze(Object.defineProperty({__proto__:null,prerender:Mt,ssr:Pt},Symbol.toStringTag,{value:"Module"}));function Ht(){const{subscribe:l,set:t,update:e}=je({isUnlocked:!1,masterPassword:null,error:null});return{subscribe:l,unlock:s=>{e(r=>({...r,isUnlocked:!0,masterPassword:s,error:null}))},setError:s=>{e(r=>({...r,error:s}))},clearError:()=>{e(s=>({...s,error:null}))},reset:()=>{t({isUnlocked:!1,masterPassword:null,error:null})}}}const he=Ht();function Vt(){const{subscribe:l,set:t,update:e}=je(new Map);return{subscribe:l,add:(s,r)=>{e(o=>{const n=new Map(o);return n.set(s,r),n})},get:s=>{let r;return l(o=>{r=o.get(s)})(),r},has:s=>{let r=!1;return l(o=>{r=o.has(s)})(),r},clear:()=>{t(new Map)}}}const gt=Vt();function Nt(){const{subscribe:l,set:t,update:e}=je({archives:[],isLoading:!1,error:null});return{subscribe:l,setArchives:s=>{t({archives:s,isLoading:!1,error:null})},setLoading:s=>{e(r=>({...r,isLoading:s}))},setError:s=>{e(r=>({...r,error:s,isLoading:!1}))},reset:()=>{t({archives:[],isLoading:!1,error:null})}}}const We=Nt(),Bt=_t(We,l=>{if(!l.archives.length)return[];const t=new Map,e=new Map;return l.archives.forEach(s=>{const r=`${s.server_id}-${s.channel_id}`;e.has(r)||e.set(r,[]),e.get(r).push(s)}),e.forEach((s,r)=>{s.sort((a,i)=>new Date(i.exported_at).getTime()-new Date(a.exported_at).getTime());const o=s[0];t.has(o.server_id)||t.set(o.server_id,{id:o.server_id,name:o.server_name,channels:[]});const n={...o,versions:s,versionCount:s.length};t.get(o.server_id).channels.push(n)}),Array.from(t.values())}),xt=_t(We,l=>{const t=new Set(l.archives.map(s=>s.server_id)),e=new Set(l.archives.map(s=>s.channel_id));return{totalArchives:l.archives.length,uniqueServers:t.size,uniqueChannels:e.size}}),Ce={github:{repoUrl:void 0,branch:"main",pat:void 0}},ze={repoUrl:"",branch:Ce.github.branch,pat:Ce.github.pat},He="discord-archiver-github-settings";function Ot(){try{const l=localStorage.getItem(He);if(l){const t=JSON.parse(l);return{...ze,...t}}}catch(l){console.error("Failed to load GitHub settings from localStorage:",l)}return ze}function jt(){const{subscribe:l,set:t,update:e}=je(Ot());return{subscribe:l,set:s=>{try{localStorage.setItem(He,JSON.stringify(s))}catch(r){console.error("Failed to save GitHub settings to localStorage:",r)}t(s)},update:s=>{e(r=>{const o=s(r);try{localStorage.setItem(He,JSON.stringify(o))}catch(n){console.error("Failed to save GitHub settings to localStorage:",n)}return o})},reset:()=>{try{localStorage.removeItem(He)}catch(s){console.error("Failed to remove GitHub settings from localStorage:",s)}t(ze)}}}const xe=jt(),qt=6e5;async function Rt(l,t){const e=new TextEncoder,s=await crypto.subtle.importKey("raw",e.encode(l),"PBKDF2",!1,["deriveBits"]),r=await crypto.subtle.deriveBits({name:"PBKDF2",salt:t,iterations:qt,hash:"SHA-256"},s,256);return await crypto.subtle.importKey("raw",r,"AES-GCM",!1,["decrypt"])}async function Gt(l){const e=new TextEncoder().encode(l),s=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(s)).map(n=>n.toString(16).padStart(2,"0")).join("").substring(0,8)}async function Ft(l,t){return await Gt(l)===t}const De=8,Re=12;async function wt(l,t){if(l.length<De+Re)throw new Error("Invalid encrypted data: too short");const e=l.slice(0,De),s=l.slice(De,De+Re),r=l.slice(De+Re),o=await Rt(t,e),n=await crypto.subtle.decrypt({name:"AES-GCM",iv:s},o,r);return new Uint8Array(n)}async function zt(l,t){const e=await wt(l,t),r=new TextDecoder().decode(e);return JSON.parse(r)}async function Kt(l,t){const e=await t.fetchMetadata();return await zt(e,l)}async function Wt(l,t,e){const s=await e.fetchArchive(l);return await wt(s,t)}function Jt(l,t){const e=t.format==="html"||t.format.startsWith("html")?"text/html":t.format==="json"?"application/json":"text/plain",s=new Blob([l],{type:e});return URL.createObjectURL(s)}class Je{constructor(t){Pe(this,"repoUrl");Pe(this,"branch");Pe(this,"pat");this.repoUrl=t.repoUrl,this.branch=t.branch,this.pat=t.pat}buildRawUrl(t){const e=t.startsWith("/")?t.slice(1):t;return`https://raw.githubusercontent.com/${this.repoUrl}/${this.branch}/${e}`}async fetchFile(t){const e=this.buildRawUrl(t),s={Accept:"application/octet-stream"};this.pat&&(s.Authorization=`token ${this.pat}`);const r=await fetch(e,{headers:s});if(!r.ok)throw r.status===404?new Error(`File not found in GitHub repository: ${t}`):r.status===401||r.status===403?new Error("GitHub authentication failed. Check your PAT or repository permissions."):new Error(`Failed to fetch file from GitHub: ${r.status} ${r.statusText}`);const o=await r.arrayBuffer();return new Uint8Array(o)}async fetchMetadata(){return this.fetchFile(".archive_metadata.json.enc")}async fetchArchive(t){return this.fetchFile(t)}async testConnection(){try{return await this.fetchMetadata(),!0}catch(t){return console.error("GitHub connection test failed:",t),!1}}}function st(l){let t,e,s,r,o,n;return{c(){t=v("div"),e=Ne("svg"),s=Ne("path"),r=A(),o=v("span"),n=H(l[2]),this.h()},l(a){t=b(a,"DIV",{class:!0});var i=E(t);e=Ve(i,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0});var d=E(e);s=Ve(d,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),E(s).forEach(p),d.forEach(p),r=U(i),o=b(i,"SPAN",{class:!0});var f=E(o);n=P(f,l[2]),f.forEach(p),i.forEach(p),this.h()},h(){u(s,"stroke-linecap","round"),u(s,"stroke-linejoin","round"),u(s,"stroke-width","2"),u(s,"d","M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"),u(e,"xmlns","http://www.w3.org/2000/svg"),u(e,"class","stroke-current shrink-0 h-6 w-6"),u(e,"fill","none"),u(e,"viewBox","0 0 24 24"),u(o,"class","text-sm"),u(t,"class","alert alert-error mb-3")},m(a,i){M(a,t,i),c(t,e),c(e,s),c(t,r),c(t,o),c(o,n)},p(a,i){i&4&&Z(n,a[2])},d(a){a&&p(t)}}}function Zt(l){let t,e,s,r="Master Password Required",o,n,a="Enter your master password to decrypt the archive metadata and browse your archives.",i,d,f,w,h,_,m=l[1]?"Unlocking...":"Unlock",y,C,g,S=l[2]&&st(l);return{c(){t=v("dialog"),e=v("div"),s=v("h3"),s.textContent=r,o=A(),n=v("p"),n.textContent=a,i=A(),d=v("input"),f=A(),S&&S.c(),w=A(),h=v("div"),_=v("button"),y=H(m),this.h()},l(k){t=b(k,"DIALOG",{class:!0});var L=E(t);e=b(L,"DIV",{class:!0});var T=E(e);s=b(T,"H3",{class:!0,"data-svelte-h":!0}),x(s)!=="svelte-12v7ilt"&&(s.textContent=r),o=U(T),n=b(T,"P",{class:!0,"data-svelte-h":!0}),x(n)!=="svelte-1nzkc2t"&&(n.textContent=a),i=U(T),d=b(T,"INPUT",{type:!0,placeholder:!0,class:!0}),f=U(T),S&&S.l(T),w=U(T),h=b(T,"DIV",{class:!0});var Y=E(h);_=b(Y,"BUTTON",{class:!0});var R=E(_);y=P(R,m),R.forEach(p),Y.forEach(p),T.forEach(p),L.forEach(p),this.h()},h(){u(s,"class","font-bold text-lg mb-2"),u(n,"class","text-sm text-base-content/70 mb-4"),u(d,"type","password"),u(d,"placeholder","Master password"),u(d,"class","input input-bordered w-full mb-3"),d.disabled=l[1],d.autofocus=!0,J(d,"input-error",l[2]),u(_,"class","btn btn-primary"),_.disabled=l[1],J(_,"loading",l[1]),u(h,"class","modal-action"),u(e,"class","modal-box bg-base-200"),u(t,"class","modal modal-open")},m(k,L){M(k,t,L),c(t,e),c(e,s),c(e,o),c(e,n),c(e,i),c(e,d),ae(d,l[0]),c(e,f),S&&S.m(e,null),c(e,w),c(e,h),c(h,_),c(_,y),d.focus(),C||(g=[F(d,"input",l[7]),F(d,"keypress",l[4]),F(_,"click",l[3])],C=!0)},p(k,[L]){L&2&&(d.disabled=k[1]),L&1&&d.value!==k[0]&&ae(d,k[0]),L&4&&J(d,"input-error",k[2]),k[2]?S?S.p(k,L):(S=st(k),S.c(),S.m(e,w)):S&&(S.d(1),S=null),L&2&&m!==(m=k[1]?"Unlocking...":"Unlock")&&Z(y,m),L&2&&(_.disabled=k[1]),L&2&&J(_,"loading",k[1])},i:te,o:te,d(k){k&&p(t),S&&S.d(),C=!1,Ke(g)}}}function Yt(l,t,e){let s,r,o,n;pe(l,he,h=>e(5,o=h)),pe(l,xe,h=>e(6,n=h));let a="",i=!1;async function d(){if(!a){he.setError("Password cannot be empty");return}if(!n.repoUrl){he.setError("GitHub repository not configured. Please check settings.");return}e(1,i=!0),he.clearError();try{const h=await Kt(a,s);he.unlock(a),We.setArchives(h.archives||[])}catch(h){console.error("Decryption error:",h),he.setError("Incorrect password or corrupted metadata file"),e(0,a="")}finally{e(1,i=!1)}}function f(h){h.key==="Enter"&&d()}function w(){a=this.value,e(0,a)}return l.$$.update=()=>{l.$$.dirty&64&&(s=new Je(n)),l.$$.dirty&32&&e(2,r=o.error)},[a,i,r,d,f,o,n,w]}class Qt extends ve{constructor(t){super(),me(this,t,Yt,Zt,be,{})}}function lt(l){let t,e,s,r="Archive Password Required",o,n,a="This archive is encrypted. Enter the password to decrypt and view it.",i,d,f,w,h,_,m,y,C,g,S=l[3]?"Decrypting...":"Decrypt",k,L,T,Y="<button>close</button>",R,oe,V=l[1]?.secret_hint&&rt(l),I=l[4]&&nt(l);return{c(){t=v("dialog"),e=v("div"),s=v("h3"),s.textContent=r,o=A(),n=v("p"),n.textContent=a,i=A(),V&&V.c(),d=A(),f=v("input"),w=A(),I&&I.c(),h=A(),_=v("div"),m=v("button"),y=H("Cancel"),C=A(),g=v("button"),k=H(S),L=A(),T=v("form"),T.innerHTML=Y,this.h()},l(D){t=b(D,"DIALOG",{class:!0});var O=E(t);e=b(O,"DIV",{class:!0});var j=E(e);s=b(j,"H3",{class:!0,"data-svelte-h":!0}),x(s)!=="svelte-j0hl0n"&&(s.textContent=r),o=U(j),n=b(j,"P",{class:!0,"data-svelte-h":!0}),x(n)!=="svelte-1iz8eou"&&(n.textContent=a),i=U(j),V&&V.l(j),d=U(j),f=b(j,"INPUT",{type:!0,placeholder:!0,class:!0}),w=U(j),I&&I.l(j),h=U(j),_=b(j,"DIV",{class:!0});var N=E(_);m=b(N,"BUTTON",{class:!0});var le=E(m);y=P(le,"Cancel"),le.forEach(p),C=U(N),g=b(N,"BUTTON",{class:!0});var Q=E(g);k=P(Q,S),Q.forEach(p),N.forEach(p),j.forEach(p),L=U(O),T=b(O,"FORM",{method:!0,class:!0,"data-svelte-h":!0}),x(T)!=="svelte-1eado74"&&(T.innerHTML=Y),O.forEach(p),this.h()},h(){u(s,"class","font-bold text-lg mb-2"),u(n,"class","text-sm text-base-content/70 mb-3"),u(f,"type","password"),u(f,"placeholder","Archive password"),u(f,"class","input input-bordered w-full mb-3"),f.disabled=l[3],f.autofocus=!0,J(f,"input-error",l[4]),u(m,"class","btn btn-ghost"),m.disabled=l[3],u(g,"class","btn btn-primary"),g.disabled=l[3],J(g,"loading",l[3]),u(_,"class","modal-action"),u(e,"class","modal-box bg-base-200"),u(T,"method","dialog"),u(T,"class","modal-backdrop"),u(t,"class","modal modal-open")},m(D,O){M(D,t,O),c(t,e),c(e,s),c(e,o),c(e,n),c(e,i),V&&V.m(e,null),c(e,d),c(e,f),ae(f,l[2]),c(e,w),I&&I.m(e,null),c(e,h),c(e,_),c(_,m),c(m,y),c(_,C),c(_,g),c(g,k),c(t,L),c(t,T),f.focus(),R||(oe=[F(f,"input",l[8]),F(f,"keypress",l[7]),F(m,"click",l[6]),F(g,"click",l[5]),F(T,"click",l[6])],R=!0)},p(D,O){D[1]?.secret_hint?V?V.p(D,O):(V=rt(D),V.c(),V.m(e,d)):V&&(V.d(1),V=null),O&8&&(f.disabled=D[3]),O&4&&f.value!==D[2]&&ae(f,D[2]),O&16&&J(f,"input-error",D[4]),D[4]?I?I.p(D,O):(I=nt(D),I.c(),I.m(e,h)):I&&(I.d(1),I=null),O&8&&(m.disabled=D[3]),O&8&&S!==(S=D[3]?"Decrypting...":"Decrypt")&&Z(k,S),O&8&&(g.disabled=D[3]),O&8&&J(g,"loading",D[3])},d(D){D&&p(t),V&&V.d(),I&&I.d(),R=!1,Ke(oe)}}}function rt(l){let t,e,s="Password hint:",r,o,n=l[1].secret_hint+"",a;return{c(){t=v("div"),e=v("span"),e.textContent=s,r=A(),o=v("span"),a=H(n),this.h()},l(i){t=b(i,"DIV",{class:!0});var d=E(t);e=b(d,"SPAN",{class:!0,"data-svelte-h":!0}),x(e)!=="svelte-ngl7h5"&&(e.textContent=s),r=U(d),o=b(d,"SPAN",{class:!0});var f=E(o);a=P(f,n),f.forEach(p),d.forEach(p),this.h()},h(){u(e,"class","text-xs text-base-content/50"),u(o,"class","text-sm font-mono ml-2"),u(t,"class","bg-base-300 rounded px-3 py-2 mb-3")},m(i,d){M(i,t,d),c(t,e),c(t,r),c(t,o),c(o,a)},p(i,d){d&2&&n!==(n=i[1].secret_hint+"")&&Z(a,n)},d(i){i&&p(t)}}}function nt(l){let t,e,s,r,o,n;return{c(){t=v("div"),e=Ne("svg"),s=Ne("path"),r=A(),o=v("span"),n=H(l[4]),this.h()},l(a){t=b(a,"DIV",{class:!0});var i=E(t);e=Ve(i,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0});var d=E(e);s=Ve(d,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),E(s).forEach(p),d.forEach(p),r=U(i),o=b(i,"SPAN",{class:!0});var f=E(o);n=P(f,l[4]),f.forEach(p),i.forEach(p),this.h()},h(){u(s,"stroke-linecap","round"),u(s,"stroke-linejoin","round"),u(s,"stroke-width","2"),u(s,"d","M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"),u(e,"xmlns","http://www.w3.org/2000/svg"),u(e,"class","stroke-current shrink-0 h-6 w-6"),u(e,"fill","none"),u(e,"viewBox","0 0 24 24"),u(o,"class","text-sm"),u(t,"class","alert alert-error mb-3")},m(a,i){M(a,t,i),c(t,e),c(e,s),c(t,r),c(t,o),c(o,n)},p(a,i){i&16&&Z(n,a[4])},d(a){a&&p(t)}}}function Xt(l){let t,e=l[0]&&lt(l);return{c(){e&&e.c(),t=Se()},l(s){e&&e.l(s),t=Se()},m(s,r){e&&e.m(s,r),M(s,t,r)},p(s,[r]){s[0]?e?e.p(s,r):(e=lt(s),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null)},i:te,o:te,d(s){s&&p(t),e&&e.d(s)}}}function $t(l,t,e){let{archive:s=null}=t,{show:r=!1}=t;const o=Oe();let n="",a=!1,i="";async function d(){if(!s||!n){e(4,i="Password cannot be empty");return}e(3,a=!0),e(4,i="");try{if(!await Ft(n,s.secret_hint))throw new Error("Password hint mismatch");gt.add(s.secret_hint,n),o("unlock",{archive:s,password:n}),f()}catch(_){console.error("Archive unlock error:",_),e(4,i="Incorrect password"),e(2,n="")}finally{e(3,a=!1)}}function f(){e(0,r=!1),e(2,n=""),e(4,i="")}function w(_){_.key==="Enter"?d():_.key==="Escape"&&f()}function h(){n=this.value,e(2,n)}return l.$$set=_=>{"archive"in _&&e(1,s=_.archive),"show"in _&&e(0,r=_.show)},[r,s,n,a,i,d,f,w,h]}class es extends ve{constructor(t){super(),me(this,t,$t,Xt,be,{archive:1,show:0})}}function at(l){let t,e,s,r='<h2 id="settings-title" class="text-2xl font-bold">GitHub Repository Settings</h2> <p class="text-sm text-base-content/70 mt-1">Configure the GitHub repository where your encrypted archives are stored</p>',o,n,a,i,d,f='<span class="label-text font-semibold">Repository URL</span>',w,h,_,m,y='<span class="label-text-alt">Format: owner/repo (required)</span>',C,g,S,k='<span class="label-text font-semibold">Branch</span>',L,T,Y,R,oe='<span class="label-text-alt">Branch containing the archives</span>',V,I,D,O='<span class="label-text font-semibold">Personal Access Token (Optional)</span>',j,N,le,Q,_e='<span class="label-text-alt">Required for private repositories. Needs &quot;Contents: Read&quot; permission.</span>',z,B,q,ie,ue,re,X,$,de="Cancel",ge,fe,Ze="Save Settings",qe,Ye;function Qe(G,se){return G[2]?ss:ts}let Ie=Qe(l),ce=Ie(l),K=l[3]&&ot(l);return{c(){t=v("div"),e=v("div"),s=v("div"),s.innerHTML=r,o=A(),n=v("div"),a=v("div"),i=v("div"),d=v("label"),d.innerHTML=f,w=A(),h=v("input"),_=A(),m=v("label"),m.innerHTML=y,C=A(),g=v("div"),S=v("label"),S.innerHTML=k,L=A(),T=v("input"),Y=A(),R=v("label"),R.innerHTML=oe,V=A(),I=v("div"),D=v("label"),D.innerHTML=O,j=A(),N=v("input"),le=A(),Q=v("label"),Q.innerHTML=_e,z=A(),B=v("div"),q=v("button"),ce.c(),ue=A(),K&&K.c(),re=A(),X=v("div"),$=v("button"),$.textContent=de,ge=A(),fe=v("button"),fe.textContent=Ze,this.h()},l(G){t=b(G,"DIV",{class:!0,role:!0,"aria-labelledby":!0,"aria-modal":!0});var se=E(t);e=b(se,"DIV",{class:!0,role:!0});var we=E(e);s=b(we,"DIV",{class:!0,"data-svelte-h":!0}),x(s)!=="svelte-19untjr"&&(s.innerHTML=r),o=U(we),n=b(we,"DIV",{class:!0});var Xe=E(n);a=b(Xe,"DIV",{class:!0});var ne=E(a);i=b(ne,"DIV",{class:!0});var ke=E(i);d=b(ke,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),x(d)!=="svelte-17dli6s"&&(d.innerHTML=f),w=U(ke),h=b(ke,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),_=U(ke),m=b(ke,"LABEL",{class:!0,"data-svelte-h":!0}),x(m)!=="svelte-k7t3zx"&&(m.innerHTML=y),ke.forEach(p),C=U(ne),g=b(ne,"DIV",{class:!0});var ye=E(g);S=b(ye,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),x(S)!=="svelte-139el95"&&(S.innerHTML=k),L=U(ye),T=b(ye,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),Y=U(ye),R=b(ye,"LABEL",{class:!0,"data-svelte-h":!0}),x(R)!=="svelte-1ukeugw"&&(R.innerHTML=oe),ye.forEach(p),V=U(ne),I=b(ne,"DIV",{class:!0});var Ee=E(I);D=b(Ee,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),x(D)!=="svelte-1gmd0qw"&&(D.innerHTML=O),j=U(Ee),N=b(Ee,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),le=U(Ee),Q=b(Ee,"LABEL",{class:!0,"data-svelte-h":!0}),x(Q)!=="svelte-19turei"&&(Q.innerHTML=_e),Ee.forEach(p),z=U(ne),B=b(ne,"DIV",{class:!0});var $e=E(B);q=b($e,"BUTTON",{class:!0});var et=E(q);ce.l(et),et.forEach(p),$e.forEach(p),ue=U(ne),K&&K.l(ne),ne.forEach(p),Xe.forEach(p),re=U(we),X=b(we,"DIV",{class:!0});var Me=E(X);$=b(Me,"BUTTON",{class:!0,"data-svelte-h":!0}),x($)!=="svelte-121k3bn"&&($.textContent=de),ge=U(Me),fe=b(Me,"BUTTON",{class:!0,"data-svelte-h":!0}),x(fe)!=="svelte-1qsodft"&&(fe.textContent=Ze),Me.forEach(p),we.forEach(p),se.forEach(p),this.h()},h(){u(s,"class","border-b border-base-300 p-6"),u(d,"class","label"),u(d,"for","repo-url"),u(h,"id","repo-url"),u(h,"type","text"),u(h,"placeholder","owner/repo (e.g., palaima/discord-archives)"),u(h,"class","input input-bordered w-full"),h.required=!0,u(m,"class","label"),u(i,"class","form-control"),u(S,"class","label"),u(S,"for","branch"),u(T,"id","branch"),u(T,"type","text"),u(T,"placeholder","main"),u(T,"class","input input-bordered w-full"),u(R,"class","label"),u(g,"class","form-control"),u(D,"class","label"),u(D,"for","pat"),u(N,"id","pat"),u(N,"type","password"),u(N,"placeholder","github_pat_xxxxx..."),u(N,"class","input input-bordered w-full font-mono text-sm"),u(Q,"class","label"),u(I,"class","form-control"),u(q,"class","btn btn-outline btn-sm"),q.disabled=ie=l[2]||!l[1].repoUrl,u(B,"class","form-control"),u(a,"class","space-y-4"),u(n,"class","p-6 space-y-6"),u($,"class","btn btn-ghost"),u(fe,"class","btn btn-primary"),u(X,"class","border-t border-base-300 p-6 flex justify-end gap-3"),u(e,"class","bg-base-200 rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"),u(e,"role","document"),u(t,"class","fixed inset-0 bg-black bg-opacity-50 z-40 flex items-center justify-center"),u(t,"role","dialog"),u(t,"aria-labelledby","settings-title"),u(t,"aria-modal","true")},m(G,se){M(G,t,se),c(t,e),c(e,s),c(e,o),c(e,n),c(n,a),c(a,i),c(i,d),c(i,w),c(i,h),ae(h,l[1].repoUrl),c(i,_),c(i,m),c(a,C),c(a,g),c(g,S),c(g,L),c(g,T),ae(T,l[1].branch),c(g,Y),c(g,R),c(a,V),c(a,I),c(I,D),c(I,j),c(I,N),ae(N,l[1].pat),c(I,le),c(I,Q),c(a,z),c(a,B),c(B,q),ce.m(q,null),c(a,ue),K&&K.m(a,null),c(e,re),c(e,X),c(X,$),c(X,ge),c(X,fe),qe||(Ye=[F(h,"input",l[10]),F(T,"input",l[11]),F(N,"input",l[12]),F(q,"click",l[6]),F($,"click",l[5]),F(fe,"click",l[4]),F(e,"click",Et(l[9])),F(e,"keydown",l[7]),F(t,"click",l[5])],qe=!0)},p(G,se){se&2&&h.value!==G[1].repoUrl&&ae(h,G[1].repoUrl),se&2&&T.value!==G[1].branch&&ae(T,G[1].branch),se&2&&N.value!==G[1].pat&&ae(N,G[1].pat),Ie!==(Ie=Qe(G))&&(ce.d(1),ce=Ie(G),ce&&(ce.c(),ce.m(q,null))),se&6&&ie!==(ie=G[2]||!G[1].repoUrl)&&(q.disabled=ie),G[3]?K?K.p(G,se):(K=ot(G),K.c(),K.m(a,null)):K&&(K.d(1),K=null)},d(G){G&&p(t),ce.d(),K&&K.d(),qe=!1,Ke(Ye)}}}function ts(l){let t;return{c(){t=H("Test Connection")},l(e){t=P(e,"Test Connection")},m(e,s){M(e,t,s)},d(e){e&&p(t)}}}function ss(l){let t,e;return{c(){t=v("span"),e=H(`
								Testing...`),this.h()},l(s){t=b(s,"SPAN",{class:!0}),E(t).forEach(p),e=P(s,`
								Testing...`),this.h()},h(){u(t,"class","loading loading-spinner loading-sm")},m(s,r){M(s,t,r),M(s,e,r)},d(s){s&&(p(t),p(e))}}}function ot(l){let t,e,s,r=l[3].success?"Success":"Error",o,n,a,i=l[3].message+"",d;return{c(){t=v("div"),e=v("div"),s=v("span"),o=H(r),n=A(),a=v("p"),d=H(i),this.h()},l(f){t=b(f,"DIV",{class:!0});var w=E(t);e=b(w,"DIV",{});var h=E(e);s=b(h,"SPAN",{class:!0});var _=E(s);o=P(_,r),_.forEach(p),n=U(h),a=b(h,"P",{class:!0});var m=E(a);d=P(m,i),m.forEach(p),h.forEach(p),w.forEach(p),this.h()},h(){u(s,"class","font-semibold"),u(a,"class","text-sm"),u(t,"class","alert"),J(t,"alert-success",l[3].success),J(t,"alert-error",!l[3].success)},m(f,w){M(f,t,w),c(t,e),c(e,s),c(s,o),c(e,n),c(e,a),c(a,d)},p(f,w){w&8&&r!==(r=f[3].success?"Success":"Error")&&Z(o,r),w&8&&i!==(i=f[3].message+"")&&Z(d,i),w&8&&J(t,"alert-success",f[3].success),w&8&&J(t,"alert-error",!f[3].success)},d(f){f&&p(t)}}}function ls(l){let t,e=l[0]&&at(l);return{c(){e&&e.c(),t=Se()},l(s){e&&e.l(s),t=Se()},m(s,r){e&&e.m(s,r),M(s,t,r)},p(s,[r]){s[0]?e?e.p(s,r):(e=at(s),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null)},i:te,o:te,d(s){s&&p(t),e&&e.d(s)}}}function rs(l,t,e){let s;pe(l,xe,k=>e(13,s=k));const r=Oe();let o=!1,n=s,a=!1,i=null;function d(){e(0,o=!0),e(1,n={...s}),e(3,i=null)}function f(){e(0,o=!1),r("close")}function w(){xe.set(n),f()}function h(){e(1,n={...s}),f()}async function _(){if(!n.repoUrl){e(3,i={success:!1,message:"Please enter a repository URL"});return}e(2,a=!0),e(3,i=null);try{await new Je(n).testConnection()?e(3,i={success:!0,message:"Connection successful! Metadata file found."}):e(3,i={success:!1,message:"Connection failed. Check repository URL and permissions."})}catch(k){e(3,i={success:!1,message:k instanceof Error?k.message:"Unknown error occurred"})}finally{e(2,a=!1)}}function m(k){k.key==="Escape"&&h()}function y(k){Ct.call(this,l,k)}function C(){n.repoUrl=this.value,e(1,n),e(0,o)}function g(){n.branch=this.value,e(1,n),e(0,o)}function S(){n.pat=this.value,e(1,n),e(0,o)}return l.$$.update=()=>{l.$$.dirty&3&&o&&!n.repoUrl&&Ce.github.repoUrl&&e(1,n={...n,repoUrl:Ce.github.repoUrl,branch:Ce.github.branch,pat:Ce.github.pat})},[o,n,a,i,w,h,_,m,d,y,C,g,S]}class ns extends ve{constructor(t){super(),me(this,t,rs,ls,be,{open:8})}get open(){return this.$$.ctx[8]}}function as(l){let t,e,s,r,o="Discord Archives",n,a,i='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>',d,f,w,h,_=l[0].totalArchives+"",m,y,C,g,S,k=l[0].uniqueServers+"",L,T,Y,R,oe,V=l[0].uniqueChannels+"",I,D,O,j,N,le,Q;const _e=l[3].default,z=St(_e,l,l[2],null);return{c(){t=v("div"),e=v("div"),s=v("div"),r=v("h1"),r.textContent=o,n=A(),a=v("button"),a.innerHTML=i,d=A(),f=v("div"),w=v("div"),h=H("ðŸ“ "),m=H(_),y=H(" archives"),C=A(),g=v("div"),S=H("ðŸ–¥ï¸ "),L=H(k),T=H(" servers"),Y=A(),R=v("div"),oe=H("ðŸ’¬ "),I=H(V),D=H(" channels"),O=A(),j=v("div"),z&&z.c(),this.h()},l(B){t=b(B,"DIV",{class:!0});var q=E(t);e=b(q,"DIV",{class:!0});var ie=E(e);s=b(ie,"DIV",{class:!0});var ue=E(s);r=b(ue,"H1",{class:!0,"data-svelte-h":!0}),x(r)!=="svelte-176jj07"&&(r.textContent=o),n=U(ue),a=b(ue,"BUTTON",{class:!0,title:!0,"aria-label":!0,"data-svelte-h":!0}),x(a)!=="svelte-9qjold"&&(a.innerHTML=i),ue.forEach(p),d=U(ie),f=b(ie,"DIV",{class:!0});var re=E(f);w=b(re,"DIV",{});var X=E(w);h=P(X,"ðŸ“ "),m=P(X,_),y=P(X," archives"),X.forEach(p),C=U(re),g=b(re,"DIV",{});var $=E(g);S=P($,"ðŸ–¥ï¸ "),L=P($,k),T=P($," servers"),$.forEach(p),Y=U(re),R=b(re,"DIV",{});var de=E(R);oe=P(de,"ðŸ’¬ "),I=P(de,V),D=P(de," channels"),de.forEach(p),re.forEach(p),ie.forEach(p),O=U(q),j=b(q,"DIV",{class:!0});var ge=E(j);z&&z.l(ge),ge.forEach(p),q.forEach(p),this.h()},h(){u(r,"class","text-xl font-semibold"),u(a,"class","btn btn-ghost btn-sm btn-square"),u(a,"title","Settings"),u(a,"aria-label","Open settings"),u(s,"class","flex items-center justify-between mb-3"),u(f,"class","text-sm space-y-1 text-base-content/70"),u(e,"class","p-5 bg-base-300 border-b border-base-100"),u(j,"class","flex-1 overflow-y-auto p-3"),u(t,"class","w-80 bg-base-200 border-r border-base-300 flex flex-col h-screen")},m(B,q){M(B,t,q),c(t,e),c(e,s),c(s,r),c(s,n),c(s,a),c(e,d),c(e,f),c(f,w),c(w,h),c(w,m),c(w,y),c(f,C),c(f,g),c(g,S),c(g,L),c(g,T),c(f,Y),c(f,R),c(R,oe),c(R,I),c(R,D),c(t,O),c(t,j),z&&z.m(j,null),N=!0,le||(Q=F(a,"click",l[1]),le=!0)},p(B,[q]){(!N||q&1)&&_!==(_=B[0].totalArchives+"")&&Z(m,_),(!N||q&1)&&k!==(k=B[0].uniqueServers+"")&&Z(L,k),(!N||q&1)&&V!==(V=B[0].uniqueChannels+"")&&Z(I,V),z&&z.p&&(!N||q&4)&&Tt(z,_e,B,B[2],N?At(_e,B[2],q,null):Ut(B[2]),null)},i(B){N||(W(z,B),N=!0)},o(B){ee(z,B),N=!1},d(B){B&&p(t),z&&z.d(B),le=!1,Q()}}}function os(l,t,e){let s;pe(l,xt,i=>e(0,s=i));let{$$slots:r={},$$scope:o}=t;const n=Oe();function a(){n("openSettings")}return l.$$set=i=>{"$$scope"in i&&e(2,o=i.$$scope)},[s,a,o,r]}class is extends ve{constructor(t){super(),me(this,t,os,as,be,{})}}function it(l,t,e){const s=l.slice();return s[6]=t[e],s}function ct(l){let t,e=Be(l[1].channels),s=[];for(let r=0;r<e.length;r+=1)s[r]=ut(it(l,e,r));return{c(){t=v("div");for(let r=0;r<s.length;r+=1)s[r].c();this.h()},l(r){t=b(r,"DIV",{class:!0});var o=E(t);for(let n=0;n<s.length;n+=1)s[n].l(o);o.forEach(p),this.h()},h(){u(t,"class","pl-3 mt-2 space-y-1")},m(r,o){M(r,t,o);for(let n=0;n<s.length;n+=1)s[n]&&s[n].m(t,null)},p(r,o){if(o&10){e=Be(r[1].channels);let n;for(n=0;n<e.length;n+=1){const a=it(r,e,n);s[n]?s[n].p(a,o):(s[n]=ut(a),s[n].c(),s[n].m(t,null))}for(;n<s.length;n+=1)s[n].d(1);s.length=e.length}},d(r){r&&p(t),vt(s,r)}}}function ut(l){let t,e,s="#",r,o,n=(l[6].channel_name||l[6].channel_id)+"",a,i,d,f=new Date(l[6].exported_at).toLocaleDateString()+"",w,h,_,m;function y(){return l[4](l[6])}return{c(){t=v("button"),e=v("span"),e.textContent=s,r=A(),o=v("span"),a=H(n),i=A(),d=v("span"),w=H(f),h=A(),this.h()},l(C){t=b(C,"BUTTON",{class:!0});var g=E(t);e=b(g,"SPAN",{class:!0,"data-svelte-h":!0}),x(e)!=="svelte-ulfyf0"&&(e.textContent=s),r=U(g),o=b(g,"SPAN",{class:!0});var S=E(o);a=P(S,n),S.forEach(p),i=U(g),d=b(g,"SPAN",{class:!0});var k=E(d);w=P(k,f),k.forEach(p),h=U(g),g.forEach(p),this.h()},h(){u(e,"class","text-base-content/50 group-hover:text-base-content"),u(o,"class","flex-1"),u(d,"class","text-xs text-base-content/40"),u(t,"class","w-full px-3 py-2 rounded hover:bg-base-100 transition-colors flex items-center gap-2 text-sm text-left group")},m(C,g){M(C,t,g),c(t,e),c(t,r),c(t,o),c(o,a),c(t,i),c(t,d),c(d,w),c(t,h),_||(m=F(t,"click",y),_=!0)},p(C,g){l=C,g&2&&n!==(n=(l[6].channel_name||l[6].channel_id)+"")&&Z(a,n),g&2&&f!==(f=new Date(l[6].exported_at).toLocaleDateString()+"")&&Z(w,f)},d(C){C&&p(t),_=!1,m()}}}function cs(l){let t,e,s,r="â–¼",o,n,a=l[1].name+"",i,d,f,w,h=!l[0]&&ct(l);return{c(){t=v("div"),e=v("button"),s=v("span"),s.textContent=r,o=A(),n=v("span"),i=H(a),d=A(),h&&h.c(),this.h()},l(_){t=b(_,"DIV",{class:!0});var m=E(t);e=b(m,"BUTTON",{class:!0});var y=E(e);s=b(y,"SPAN",{class:!0,"data-svelte-h":!0}),x(s)!=="svelte-12dk04l"&&(s.textContent=r),o=U(y),n=b(y,"SPAN",{});var C=E(n);i=P(C,a),C.forEach(p),y.forEach(p),d=U(m),h&&h.l(m),m.forEach(p),this.h()},h(){u(s,"class","transform transition-transform text-xs"),J(s,"rotate-0",!l[0]),J(s,"-rotate-90",l[0]),u(e,"class","w-full px-3 py-2 bg-base-300 rounded hover:bg-base-100 transition-colors flex items-center gap-2 font-semibold text-sm"),u(t,"class","mb-4")},m(_,m){M(_,t,m),c(t,e),c(e,s),c(e,o),c(e,n),c(n,i),c(t,d),h&&h.m(t,null),f||(w=F(e,"click",l[2]),f=!0)},p(_,[m]){m&1&&J(s,"rotate-0",!_[0]),m&1&&J(s,"-rotate-90",_[0]),m&2&&a!==(a=_[1].name+"")&&Z(i,a),_[0]?h&&(h.d(1),h=null):h?h.p(_,m):(h=ct(_),h.c(),h.m(t,null))},i:te,o:te,d(_){_&&p(t),h&&h.d(),f=!1,w()}}}function us(l,t,e){let{server:s}=t,{collapsed:r=!1}=t;const o=Oe();function n(){e(0,r=!r)}function a(d){o("selectChannel",d)}const i=d=>a(d);return l.$$set=d=>{"server"in d&&e(1,s=d.server),"collapsed"in d&&e(0,r=d.collapsed)},[r,s,n,a,i]}class fs extends ve{constructor(t){super(),me(this,t,us,cs,be,{server:1,collapsed:0})}}function ds(l){let t,e="Welcome",s,r,o="Select a channel to view";return{c(){t=v("h2"),t.textContent=e,s=A(),r=v("div"),r.textContent=o,this.h()},l(n){t=b(n,"H2",{class:!0,"data-svelte-h":!0}),x(t)!=="svelte-qeexzb"&&(t.textContent=e),s=U(n),r=b(n,"DIV",{class:!0,"data-svelte-h":!0}),x(r)!=="svelte-563yit"&&(r.textContent=o),this.h()},h(){u(t,"class","text-lg font-semibold"),u(r,"class","text-sm text-base-content/60")},m(n,a){M(n,t,a),M(n,s,a),M(n,r,a)},p:te,d(n){n&&(p(t),p(s),p(r))}}}function hs(l){let t,e,s=(l[0].channel_name||l[0].channel_id)+"",r,o,n=l[0].export_path.endsWith(".enc"),a,i,d,f=new Date(l[0].exported_at).toLocaleString()+"",w,h,_=l[0].format.toUpperCase()+"",m,y=n&&ft();return{c(){t=v("div"),e=v("h2"),r=H(s),o=A(),y&&y.c(),a=A(),i=v("div"),d=H("Latest export: "),w=H(f),h=H(" â€¢ "),m=H(_),this.h()},l(C){t=b(C,"DIV",{class:!0});var g=E(t);e=b(g,"H2",{class:!0});var S=E(e);r=P(S,s),o=U(S),y&&y.l(S),S.forEach(p),g.forEach(p),a=U(C),i=b(C,"DIV",{class:!0});var k=E(i);d=P(k,"Latest export: "),w=P(k,f),h=P(k," â€¢ "),m=P(k,_),k.forEach(p),this.h()},h(){u(e,"class","text-lg font-semibold"),u(t,"class","flex items-center gap-2"),u(i,"class","text-sm text-base-content/60 mt-1")},m(C,g){M(C,t,g),c(t,e),c(e,r),c(e,o),y&&y.m(e,null),M(C,a,g),M(C,i,g),c(i,d),c(i,w),c(i,h),c(i,m)},p(C,g){g&1&&s!==(s=(C[0].channel_name||C[0].channel_id)+"")&&Z(r,s),g&1&&(n=C[0].export_path.endsWith(".enc")),n?y||(y=ft(),y.c(),y.m(e,null)):y&&(y.d(1),y=null),g&1&&f!==(f=new Date(C[0].exported_at).toLocaleString()+"")&&Z(w,f),g&1&&_!==(_=C[0].format.toUpperCase()+"")&&Z(m,_)},d(C){C&&(p(t),p(a),p(i)),y&&y.d()}}}function ft(l){let t,e="ðŸ”’";return{c(){t=v("span"),t.textContent=e,this.h()},l(s){t=b(s,"SPAN",{class:!0,"data-svelte-h":!0}),x(t)!=="svelte-1cny2mi"&&(t.textContent=e),this.h()},h(){u(t,"class","ml-2")},m(s,r){M(s,t,r)},d(s){s&&p(t)}}}function ps(l){let t,e='<div class="text-6xl mb-4">ðŸ“–</div> <div class="text-lg">Select a channel from the sidebar to start browsing</div>';return{c(){t=v("div"),t.innerHTML=e,this.h()},l(s){t=b(s,"DIV",{class:!0,"data-svelte-h":!0}),x(t)!=="svelte-54z0r5"&&(t.innerHTML=e),this.h()},h(){u(t,"class","flex flex-col items-center justify-center h-full text-base-content/40")},m(s,r){M(s,t,r)},p:te,d(s){s&&p(t)}}}function bs(l){let t,e;return{c(){t=v("iframe"),this.h()},l(s){t=b(s,"IFRAME",{src:!0,title:!0,class:!0}),E(t).forEach(p),this.h()},h(){tt(t.src,e=l[1])||u(t,"src",e),u(t,"title","Archive viewer"),u(t,"class","w-full h-full border-0")},m(s,r){M(s,t,r)},p(s,r){r&2&&!tt(t.src,e=s[1])&&u(t,"src",e)},d(s){s&&p(t)}}}function vs(l){let t,e='<div class="loading loading-spinner loading-lg"></div>';return{c(){t=v("div"),t.innerHTML=e,this.h()},l(s){t=b(s,"DIV",{class:!0,"data-svelte-h":!0}),x(t)!=="svelte-1nt18fs"&&(t.innerHTML=e),this.h()},h(){u(t,"class","flex items-center justify-center h-full")},m(s,r){M(s,t,r)},p:te,d(s){s&&p(t)}}}function ms(l){let t,e,s,r;function o(w,h){return w[0]?hs:ds}let n=o(l),a=n(l);function i(w,h){return w[2]?vs:w[1]?bs:ps}let d=i(l),f=d(l);return{c(){t=v("div"),e=v("div"),a.c(),s=A(),r=v("div"),f.c(),this.h()},l(w){t=b(w,"DIV",{class:!0});var h=E(t);e=b(h,"DIV",{class:!0});var _=E(e);a.l(_),_.forEach(p),s=U(h),r=b(h,"DIV",{class:!0});var m=E(r);f.l(m),m.forEach(p),h.forEach(p),this.h()},h(){u(e,"class","p-4 bg-base-200 border-b border-base-300"),u(r,"class","flex-1 overflow-hidden"),u(t,"class","flex-1 flex flex-col bg-base-100")},m(w,h){M(w,t,h),c(t,e),a.m(e,null),c(t,s),c(t,r),f.m(r,null)},p(w,[h]){n===(n=o(w))&&a?a.p(w,h):(a.d(1),a=n(w),a&&(a.c(),a.m(e,null))),d===(d=i(w))&&f?f.p(w,h):(f.d(1),f=d(w),f&&(f.c(),f.m(r,null)))},i:te,o:te,d(w){w&&p(t),a.d(),f.d()}}}function _s(l,t,e){let{archive:s=null}=t,{blobUrl:r=null}=t,{isLoading:o=!1}=t;return l.$$set=n=>{"archive"in n&&e(0,s=n.archive),"blobUrl"in n&&e(1,r=n.blobUrl),"isLoading"in n&&e(2,o=n.isLoading)},[s,r,o]}class gs extends ve{constructor(t){super(),me(this,t,_s,ms,be,{archive:0,blobUrl:1,isLoading:2})}}function dt(l,t,e){const s=l.slice();return s[16]=t[e],s}function ht(l){let t,e;return t=new Qt({}),{c(){Le(t.$$.fragment)},l(s){Ae(t.$$.fragment,s)},m(s,r){Ue(t,s,r),e=!0},i(s){e||(W(t.$$.fragment,s),e=!0)},o(s){ee(t.$$.fragment,s),e=!1},d(s){Te(t,s)}}}function pt(l){let t,e,s,r;return t=new is({props:{$$slots:{default:[ws]},$$scope:{ctx:l}}}),t.$on("openSettings",l[10]),s=new gs({props:{archive:l[0],blobUrl:l[1],isLoading:l[2]}}),{c(){Le(t.$$.fragment),e=A(),Le(s.$$.fragment)},l(o){Ae(t.$$.fragment,o),e=U(o),Ae(s.$$.fragment,o)},m(o,n){Ue(t,o,n),M(o,e,n),Ue(s,o,n),r=!0},p(o,n){const a={};n&524416&&(a.$$scope={dirty:n,ctx:o}),t.$set(a);const i={};n&1&&(i.archive=o[0]),n&2&&(i.blobUrl=o[1]),n&4&&(i.isLoading=o[2]),s.$set(i)},i(o){r||(W(t.$$.fragment,o),W(s.$$.fragment,o),r=!0)},o(o){ee(t.$$.fragment,o),ee(s.$$.fragment,o),r=!1},d(o){o&&p(e),Te(t,o),Te(s,o)}}}function bt(l){let t,e;return t=new fs({props:{server:l[16]}}),t.$on("selectChannel",l[8]),{c(){Le(t.$$.fragment)},l(s){Ae(t.$$.fragment,s)},m(s,r){Ue(t,s,r),e=!0},p(s,r){const o={};r&128&&(o.server=s[16]),t.$set(o)},i(s){e||(W(t.$$.fragment,s),e=!0)},o(s){ee(t.$$.fragment,s),e=!1},d(s){Te(t,s)}}}function ws(l){let t,e,s=Be(l[7]),r=[];for(let n=0;n<s.length;n+=1)r[n]=bt(dt(l,s,n));const o=n=>ee(r[n],1,1,()=>{r[n]=null});return{c(){for(let n=0;n<r.length;n+=1)r[n].c();t=Se()},l(n){for(let a=0;a<r.length;a+=1)r[a].l(n);t=Se()},m(n,a){for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(n,a);M(n,t,a),e=!0},p(n,a){if(a&384){s=Be(n[7]);let i;for(i=0;i<s.length;i+=1){const d=dt(n,s,i);r[i]?(r[i].p(d,a),W(r[i],1)):(r[i]=bt(d),r[i].c(),W(r[i],1),r[i].m(t.parentNode,t))}for(Fe(),i=s.length;i<r.length;i+=1)o(i);Ge()}},i(n){if(!e){for(let a=0;a<s.length;a+=1)W(r[a]);e=!0}},o(n){r=r.filter(Boolean);for(let a=0;a<r.length;a+=1)ee(r[a]);e=!1},d(n){n&&p(t),vt(r,n)}}}function ks(l){let t,e,s,r,o,n,a,i,d,f=!l[6].isUnlocked&&ht();function w(y){l[12](y)}let h={archive:l[4]};l[3]!==void 0&&(h.show=l[3]),r=new es({props:h}),mt.push(()=>It(r,"show",w)),r.$on("unlock",l[9]);let _={};a=new ns({props:_}),l[13](a);let m=l[6].isUnlocked&&pt(l);return{c(){t=A(),e=v("div"),f&&f.c(),s=A(),Le(r.$$.fragment),n=A(),Le(a.$$.fragment),i=A(),m&&m.c(),this.h()},l(y){Dt("svelte-1v5xc6b",document.head).forEach(p),t=U(y),e=b(y,"DIV",{class:!0});var g=E(e);f&&f.l(g),s=U(g),Ae(r.$$.fragment,g),n=U(g),Ae(a.$$.fragment,g),i=U(g),m&&m.l(g),g.forEach(p),this.h()},h(){document.title="Discord Archive Browser",u(e,"class","flex h-screen overflow-hidden")},m(y,C){M(y,t,C),M(y,e,C),f&&f.m(e,null),c(e,s),Ue(r,e,null),c(e,n),Ue(a,e,null),c(e,i),m&&m.m(e,null),d=!0},p(y,[C]){y[6].isUnlocked?f&&(Fe(),ee(f,1,1,()=>{f=null}),Ge()):f?C&64&&W(f,1):(f=ht(),f.c(),W(f,1),f.m(e,s));const g={};C&16&&(g.archive=y[4]),!o&&C&8&&(o=!0,g.show=y[3],Lt(()=>o=!1)),r.$set(g);const S={};a.$set(S),y[6].isUnlocked?m?(m.p(y,C),C&64&&W(m,1)):(m=pt(y),m.c(),W(m,1),m.m(e,null)):m&&(Fe(),ee(m,1,1,()=>{m=null}),Ge())},i(y){d||(W(f),W(r.$$.fragment,y),W(a.$$.fragment,y),W(m),d=!0)},o(y){ee(f),ee(r.$$.fragment,y),ee(a.$$.fragment,y),ee(m),d=!1},d(y){y&&(p(t),p(e)),f&&f.d(),Te(r),l[13](null),Te(a),m&&m.d()}}}function ys(l,t,e){let s,r,o,n;pe(l,xe,k=>e(11,r=k)),pe(l,he,k=>e(6,o=k)),pe(l,Bt,k=>e(7,n=k));let a=null,i=null,d=!1,f=!1,w=null,h;async function _(k){const L=k.detail;if(e(0,a=L),L.export_path.endsWith(".enc")){const T=gt.get(L.secret_hint);T?await y(L,T):(e(4,w=L),e(3,f=!0))}else e(1,i=L.export_path)}async function m(k){const{archive:L,password:T}=k.detail;await y(L,T),e(3,f=!1)}async function y(k,L){e(2,d=!0);try{const T=await Wt(k.export_path,L,s);i&&i.startsWith("blob:")&&URL.revokeObjectURL(i),e(1,i=Jt(T,k))}catch(T){console.error("Failed to load encrypted archive:",T);const Y=T instanceof Error?T.message:"The file may be corrupted.";alert(`Failed to decrypt and load archive: ${Y}`)}finally{e(2,d=!1)}}function C(){h.open()}function g(k){f=k,e(3,f)}function S(k){mt[k?"unshift":"push"](()=>{h=k,e(5,h)})}return l.$$.update=()=>{l.$$.dirty&2048&&(s=new Je(r))},[a,i,d,f,w,h,o,n,_,m,C,r,g,S]}class As extends ve{constructor(t){super(),me(this,t,ys,ks,be,{})}}export{As as component,Us as universal};
