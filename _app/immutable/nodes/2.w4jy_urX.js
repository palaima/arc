var Pt=Object.defineProperty;var Vt=(r,t,e)=>t in r?Pt(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var Ke=(r,t,e)=>Vt(r,typeof t!="symbol"?t+"":t,e);import{s as ke,n as te,d as h,r as tt,P as ae,Q as $,e as Z,f as M,h as i,R as K,A as c,j as _,k as E,S as z,m as S,T as me,l as P,o as m,p as T,U as ge,t as V,q as we,V as Be,v as De,W as Nt,X as Bt,i as qt,c as jt,u as Ot,g as Gt,b as Rt,Y as Lt,Z as ht,C as Dt,_ as Ft,$ as zt}from"../chunks/Ct-DdQaZ.js";import{S as ye,i as Ee,t as re,a as X,f as Kt,d as Ie,c as Xe,m as Me,e as He,b as Pe,g as $e}from"../chunks/DldV-x9j.js";import{w as xe,d as It}from"../chunks/Bs7vbK-S.js";function Je(r){return r?.length!==void 0?r:Array.from(r)}const Wt=!0,Jt=!1,Fs=Object.freeze(Object.defineProperty({__proto__:null,prerender:Wt,ssr:Jt},Symbol.toStringTag,{value:"Module"}));function Zt(){const{subscribe:r,set:t,update:e}=xe({isUnlocked:!1,masterPassword:null,error:null});return{subscribe:r,unlock:s=>{e(l=>({...l,isUnlocked:!0,masterPassword:s,error:null}))},setError:s=>{e(l=>({...l,error:s}))},clearError:()=>{e(s=>({...s,error:null}))},reset:()=>{t({isUnlocked:!1,masterPassword:null,error:null})}}}const _e=Zt();function xt(){const{subscribe:r,set:t,update:e}=xe(new Map);return{subscribe:r,add:(s,l)=>{e(a=>{const n=new Map(a);return n.set(s,l),n})},get:s=>{let l;return r(a=>{l=a.get(s)})(),l},has:s=>{let l=!1;return r(a=>{l=a.has(s)})(),l},clear:()=>{t(new Map)}}}const Mt=xt();function Yt(){const{subscribe:r,set:t,update:e}=xe({archives:[],isLoading:!1,error:null});return{subscribe:r,setArchives:s=>{t({archives:s,isLoading:!1,error:null})},setLoading:s=>{e(l=>({...l,isLoading:s}))},setError:s=>{e(l=>({...l,error:s,isLoading:!1}))},reset:()=>{t({archives:[],isLoading:!1,error:null})}}}const st=Yt(),Qt=It(st,r=>{if(!r.archives.length)return[];const t=new Map,e=new Map;return r.archives.forEach(s=>{const l=`${s.server_id}-${s.channel_id}`;e.has(l)||e.set(l,[]),e.get(l).push(s)}),e.forEach((s,l)=>{s.sort((o,u)=>new Date(u.exported_at).getTime()-new Date(o.exported_at).getTime());const a=s[0];t.has(a.server_id)||t.set(a.server_id,{id:a.server_id,name:a.server_name,channels:[]});const n={...a,versions:s,versionCount:s.length};t.get(a.server_id).channels.push(n)}),Array.from(t.values())}),Xt=It(st,r=>{const t=new Set(r.archives.map(s=>s.server_id)),e=new Set(r.archives.map(s=>s.channel_id));return{totalArchives:r.archives.length,uniqueServers:t.size,uniqueChannels:e.size}}),Le={github:{repoUrl:void 0,branch:"main",pat:void 0}},et={repoUrl:"",branch:Le.github.branch,pat:Le.github.pat},We="discord-archiver-github-settings";function $t(){try{const r=localStorage.getItem(We);if(r){const t=JSON.parse(r);return{...et,...t}}}catch(r){console.error("Failed to load GitHub settings from localStorage:",r)}return et}function es(){const{subscribe:r,set:t,update:e}=xe($t());return{subscribe:r,set:s=>{try{localStorage.setItem(We,JSON.stringify(s))}catch(l){console.error("Failed to save GitHub settings to localStorage:",l)}t(s)},update:s=>{e(l=>{const a=s(l);try{localStorage.setItem(We,JSON.stringify(a))}catch(n){console.error("Failed to save GitHub settings to localStorage:",n)}return a})},reset:()=>{try{localStorage.removeItem(We)}catch(s){console.error("Failed to remove GitHub settings from localStorage:",s)}t(et)}}}const Ze=es(),ts=6e5;async function ss(r,t){const e=new TextEncoder,s=await crypto.subtle.importKey("raw",e.encode(r),"PBKDF2",!1,["deriveBits"]),l=await crypto.subtle.deriveBits({name:"PBKDF2",salt:t,iterations:ts,hash:"SHA-256"},s,256);return await crypto.subtle.importKey("raw",l,"AES-GCM",!0,["encrypt","decrypt"])}async function rs(r){const e=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(s)).map(n=>n.toString(16).padStart(2,"0")).join("").substring(0,8)}async function ls(r,t){return await rs(r)===t}const Ne=8,Qe=12;async function Ht(r,t){if(r.length<Ne+Qe)throw new Error("Invalid encrypted data: too short");const e=r.slice(0,Ne),s=r.slice(Ne,Ne+Qe),l=r.slice(Ne+Qe),a=await ss(t,e),n=await crypto.subtle.decrypt({name:"AES-GCM",iv:s},a,l);return new Uint8Array(n)}async function ns(r,t){const e=await Ht(r,t),l=new TextDecoder().decode(e);return JSON.parse(l)}async function as(r,t){const e=await t.fetchMetadata();return await ns(e,r)}async function os(r,t,e){const s=await e.fetchArchive(r);return await Ht(s,t)}function is(r,t){const e=t.format==="html"||t.format.startsWith("html")?"text/html":t.format==="json"?"application/json":"text/plain",s=new Blob([r],{type:e});return URL.createObjectURL(s)}class rt{constructor(t){Ke(this,"repoUrl");Ke(this,"branch");Ke(this,"pat");this.repoUrl=t.repoUrl,this.branch=t.branch,this.pat=t.pat}async fetchFile(t){const e=t.startsWith("/")?t.slice(1):t,s=`https://api.github.com/repos/${this.repoUrl}/contents/${e}?ref=${this.branch}`,l={Accept:"application/vnd.github.v3.raw"};this.pat&&(l.Authorization=`token ${this.pat}`);const a=await fetch(s,{headers:l});if(!a.ok)throw a.status===404?new Error(`File not found in GitHub repository: ${t}`):a.status===401||a.status===403?new Error("GitHub authentication failed. A Personal Access Token is required for private repositories. Please add your PAT in Settings."):new Error(`Failed to fetch file from GitHub: ${a.status} ${a.statusText}`);const n=await a.arrayBuffer();return new Uint8Array(n)}async fetchMetadata(){return this.fetchFile(".archive_metadata.json.enc")}async fetchArchive(t){return this.fetchFile(t)}async testConnection(){try{return await this.fetchMetadata(),!0}catch(t){return console.error("GitHub connection test failed:",t),!1}}}function pt(r){let t,e,s,l,a,n;return{c(){t=m("div"),e=ge("svg"),s=ge("path"),l=T(),a=m("span"),n=V(r[2]),this.h()},l(o){t=_(o,"DIV",{class:!0});var u=E(t);e=me(u,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0});var d=E(e);s=me(d,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),E(s).forEach(h),d.forEach(h),l=S(u),a=_(u,"SPAN",{class:!0});var f=E(a);n=P(f,r[2]),f.forEach(h),u.forEach(h),this.h()},h(){c(s,"stroke-linecap","round"),c(s,"stroke-linejoin","round"),c(s,"stroke-width","2"),c(s,"d","M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"),c(e,"xmlns","http://www.w3.org/2000/svg"),c(e,"class","stroke-current shrink-0 h-6 w-6"),c(e,"fill","none"),c(e,"viewBox","0 0 24 24"),c(a,"class","text-sm"),c(t,"class","alert alert-error mb-3")},m(o,u){M(o,t,u),i(t,e),i(e,s),i(t,l),i(t,a),i(a,n)},p(o,u){u&4&&Z(n,o[2])},d(o){o&&h(t)}}}function cs(r){let t,e,s,l="Master Password Required",a,n,o="Enter your master password to decrypt the archive metadata and browse your archives.",u,d,f,b,g,v,p,w,k,y,I,D,H=r[1]?"Unlocking...":"Unlock",U,N,j,B=r[2]&&pt(r);return{c(){t=m("dialog"),e=m("div"),s=m("h3"),s.textContent=l,a=T(),n=m("p"),n.textContent=o,u=T(),d=m("input"),f=T(),B&&B.c(),b=T(),g=m("div"),v=m("button"),p=ge("svg"),w=ge("path"),k=ge("path"),y=V(`
				Settings`),I=T(),D=m("button"),U=V(H),this.h()},l(C){t=_(C,"DIALOG",{class:!0});var L=E(t);e=_(L,"DIV",{class:!0});var A=E(e);s=_(A,"H3",{class:!0,"data-svelte-h":!0}),z(s)!=="svelte-12v7ilt"&&(s.textContent=l),a=S(A),n=_(A,"P",{class:!0,"data-svelte-h":!0}),z(n)!=="svelte-7uye46"&&(n.textContent=o),u=S(A),d=_(A,"INPUT",{type:!0,placeholder:!0,class:!0}),f=S(A),B&&B.l(A),b=S(A),g=_(A,"DIV",{class:!0});var O=E(g);v=_(O,"BUTTON",{class:!0});var G=E(v);p=me(G,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var q=E(p);w=me(q,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),E(w).forEach(h),k=me(q,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),E(k).forEach(h),q.forEach(h),y=P(G,`
				Settings`),G.forEach(h),I=S(O),D=_(O,"BUTTON",{class:!0});var J=E(D);U=P(J,H),J.forEach(h),O.forEach(h),A.forEach(h),L.forEach(h),this.h()},h(){c(s,"class","font-bold text-lg mb-2"),c(n,"class","text-sm text-base-content/70 mb-4"),c(d,"type","password"),c(d,"placeholder","Master password"),c(d,"class","input input-bordered w-full mb-3"),d.disabled=r[1],d.autofocus=!0,$(d,"input-error",r[2]),c(w,"stroke-linecap","round"),c(w,"stroke-linejoin","round"),c(w,"stroke-width","2"),c(w,"d","M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"),c(k,"stroke-linecap","round"),c(k,"stroke-linejoin","round"),c(k,"stroke-width","2"),c(k,"d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"),c(p,"xmlns","http://www.w3.org/2000/svg"),c(p,"class","h-4 w-4 mr-1"),c(p,"fill","none"),c(p,"viewBox","0 0 24 24"),c(p,"stroke","currentColor"),c(v,"class","btn btn-ghost btn-sm"),v.disabled=r[1],c(D,"class","btn btn-primary"),D.disabled=r[1],$(D,"loading",r[1]),c(g,"class","modal-action flex justify-between items-center"),c(e,"class","modal-box bg-base-200"),c(t,"class","modal modal-open")},m(C,L){M(C,t,L),i(t,e),i(e,s),i(e,a),i(e,n),i(e,u),i(e,d),ae(d,r[0]),i(e,f),B&&B.m(e,null),i(e,b),i(e,g),i(g,v),i(v,p),i(p,w),i(p,k),i(v,y),i(g,I),i(g,D),i(D,U),d.focus(),N||(j=[K(d,"input",r[8]),K(d,"keypress",r[4]),K(v,"click",r[5]),K(D,"click",r[3])],N=!0)},p(C,[L]){L&2&&(d.disabled=C[1]),L&1&&d.value!==C[0]&&ae(d,C[0]),L&4&&$(d,"input-error",C[2]),C[2]?B?B.p(C,L):(B=pt(C),B.c(),B.m(e,b)):B&&(B.d(1),B=null),L&2&&(v.disabled=C[1]),L&2&&H!==(H=C[1]?"Unlocking...":"Unlock")&&Z(U,H),L&2&&(D.disabled=C[1]),L&2&&$(D,"loading",C[1])},i:te,o:te,d(C){C&&h(t),B&&B.d(),N=!1,tt(j)}}}function us(r,t,e){let s,l,a,n;we(r,_e,p=>e(6,a=p)),we(r,Ze,p=>e(7,n=p));const o=Be();let u="",d=!1;async function f(){if(!u){_e.setError("Password cannot be empty");return}if(!n.repoUrl){_e.setError("GitHub repository not configured. Please check settings.");return}e(1,d=!0),_e.clearError();try{const p=await as(u,s);_e.unlock(u),st.setArchives(p.archives||[])}catch(p){console.error("Decryption error:",p),_e.setError("Incorrect password or corrupted metadata file"),e(0,u="")}finally{e(1,d=!1)}}function b(p){p.key==="Enter"&&f()}function g(){o("openSettings")}function v(){u=this.value,e(0,u)}return r.$$.update=()=>{r.$$.dirty&128&&(s=new rt(n)),r.$$.dirty&64&&e(2,l=a.error)},[u,d,l,f,b,g,a,n,v]}class fs extends ye{constructor(t){super(),Ee(this,t,us,cs,ke,{})}}function bt(r){let t,e,s,l="Archive Password Required",a,n,o="This archive is encrypted. Enter the password to decrypt and view it.",u,d,f,b,g,v,p,w,k,y,I=r[3]?"Decrypting...":"Decrypt",D,H,U,N="<button>close</button>",j,B,C=r[1]?.secret_hint&&vt(r),L=r[4]&&_t(r);return{c(){t=m("dialog"),e=m("div"),s=m("h3"),s.textContent=l,a=T(),n=m("p"),n.textContent=o,u=T(),C&&C.c(),d=T(),f=m("input"),b=T(),L&&L.c(),g=T(),v=m("div"),p=m("button"),w=V("Cancel"),k=T(),y=m("button"),D=V(I),H=T(),U=m("form"),U.innerHTML=N,this.h()},l(A){t=_(A,"DIALOG",{class:!0});var O=E(t);e=_(O,"DIV",{class:!0});var G=E(e);s=_(G,"H3",{class:!0,"data-svelte-h":!0}),z(s)!=="svelte-j0hl0n"&&(s.textContent=l),a=S(G),n=_(G,"P",{class:!0,"data-svelte-h":!0}),z(n)!=="svelte-oo4ac9"&&(n.textContent=o),u=S(G),C&&C.l(G),d=S(G),f=_(G,"INPUT",{type:!0,placeholder:!0,class:!0}),b=S(G),L&&L.l(G),g=S(G),v=_(G,"DIV",{class:!0});var q=E(v);p=_(q,"BUTTON",{class:!0});var J=E(p);w=P(J,"Cancel"),J.forEach(h),k=S(q),y=_(q,"BUTTON",{class:!0});var de=E(y);D=P(de,I),de.forEach(h),q.forEach(h),G.forEach(h),H=S(O),U=_(O,"FORM",{method:!0,class:!0,"data-svelte-h":!0}),z(U)!=="svelte-1v3agxd"&&(U.innerHTML=N),O.forEach(h),this.h()},h(){c(s,"class","font-bold text-lg mb-2"),c(n,"class","text-sm text-base-content/70 mb-3"),c(f,"type","password"),c(f,"placeholder","Archive password"),c(f,"class","input input-bordered w-full mb-3"),f.disabled=r[3],f.autofocus=!0,$(f,"input-error",r[4]),c(p,"class","btn btn-ghost"),p.disabled=r[3],c(y,"class","btn btn-primary"),y.disabled=r[3],$(y,"loading",r[3]),c(v,"class","modal-action"),c(e,"class","modal-box bg-base-200"),c(U,"method","dialog"),c(U,"class","modal-backdrop"),c(t,"class","modal modal-open")},m(A,O){M(A,t,O),i(t,e),i(e,s),i(e,a),i(e,n),i(e,u),C&&C.m(e,null),i(e,d),i(e,f),ae(f,r[2]),i(e,b),L&&L.m(e,null),i(e,g),i(e,v),i(v,p),i(p,w),i(v,k),i(v,y),i(y,D),i(t,H),i(t,U),f.focus(),j||(B=[K(f,"input",r[8]),K(f,"keypress",r[7]),K(p,"click",r[6]),K(y,"click",r[5]),K(U,"click",r[6])],j=!0)},p(A,O){A[1]?.secret_hint?C?C.p(A,O):(C=vt(A),C.c(),C.m(e,d)):C&&(C.d(1),C=null),O&8&&(f.disabled=A[3]),O&4&&f.value!==A[2]&&ae(f,A[2]),O&16&&$(f,"input-error",A[4]),A[4]?L?L.p(A,O):(L=_t(A),L.c(),L.m(e,g)):L&&(L.d(1),L=null),O&8&&(p.disabled=A[3]),O&8&&I!==(I=A[3]?"Decrypting...":"Decrypt")&&Z(D,I),O&8&&(y.disabled=A[3]),O&8&&$(y,"loading",A[3])},d(A){A&&h(t),C&&C.d(),L&&L.d(),j=!1,tt(B)}}}function vt(r){let t,e,s="Password hint:",l,a,n=r[1].secret_hint+"",o;return{c(){t=m("div"),e=m("span"),e.textContent=s,l=T(),a=m("span"),o=V(n),this.h()},l(u){t=_(u,"DIV",{class:!0});var d=E(t);e=_(d,"SPAN",{class:!0,"data-svelte-h":!0}),z(e)!=="svelte-ngl7h5"&&(e.textContent=s),l=S(d),a=_(d,"SPAN",{class:!0});var f=E(a);o=P(f,n),f.forEach(h),d.forEach(h),this.h()},h(){c(e,"class","text-xs text-base-content/50"),c(a,"class","text-sm font-mono ml-2"),c(t,"class","bg-base-300 rounded px-3 py-2 mb-3")},m(u,d){M(u,t,d),i(t,e),i(t,l),i(t,a),i(a,o)},p(u,d){d&2&&n!==(n=u[1].secret_hint+"")&&Z(o,n)},d(u){u&&h(t)}}}function _t(r){let t,e,s,l,a,n;return{c(){t=m("div"),e=ge("svg"),s=ge("path"),l=T(),a=m("span"),n=V(r[4]),this.h()},l(o){t=_(o,"DIV",{class:!0});var u=E(t);e=me(u,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0});var d=E(e);s=me(d,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),E(s).forEach(h),d.forEach(h),l=S(u),a=_(u,"SPAN",{class:!0});var f=E(a);n=P(f,r[4]),f.forEach(h),u.forEach(h),this.h()},h(){c(s,"stroke-linecap","round"),c(s,"stroke-linejoin","round"),c(s,"stroke-width","2"),c(s,"d","M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"),c(e,"xmlns","http://www.w3.org/2000/svg"),c(e,"class","stroke-current shrink-0 h-6 w-6"),c(e,"fill","none"),c(e,"viewBox","0 0 24 24"),c(a,"class","text-sm"),c(t,"class","alert alert-error mb-3")},m(o,u){M(o,t,u),i(t,e),i(e,s),i(t,l),i(t,a),i(a,n)},p(o,u){u&16&&Z(n,o[4])},d(o){o&&h(t)}}}function ds(r){let t,e=r[0]&&bt(r);return{c(){e&&e.c(),t=De()},l(s){e&&e.l(s),t=De()},m(s,l){e&&e.m(s,l),M(s,t,l)},p(s,[l]){s[0]?e?e.p(s,l):(e=bt(s),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null)},i:te,o:te,d(s){s&&h(t),e&&e.d(s)}}}function hs(r,t,e){let{archive:s=null}=t,{show:l=!1}=t;const a=Be();let n="",o=!1,u="";async function d(){if(!s||!n){e(4,u="Password cannot be empty");return}e(3,o=!0),e(4,u="");try{if(!await ls(n,s.secret_hint))throw new Error("Password hint mismatch");Mt.add(s.secret_hint,n),a("unlock",{archive:s,password:n}),f()}catch(v){console.error("Archive unlock error:",v),e(4,u="Incorrect password"),e(2,n="")}finally{e(3,o=!1)}}function f(){e(0,l=!1),e(2,n=""),e(4,u="")}function b(v){v.key==="Enter"?d():v.key==="Escape"&&f()}function g(){n=this.value,e(2,n)}return r.$$set=v=>{"archive"in v&&e(1,s=v.archive),"show"in v&&e(0,l=v.show)},[l,s,n,o,u,d,f,b,g]}class ps extends ye{constructor(t){super(),Ee(this,t,hs,ds,ke,{archive:1,show:0})}}function mt(r){let t,e,s,l,a=r[0]?"GitHub Configuration Required":"GitHub Repository Settings",n,o,u,d,f,b,g,v,p='<span class="label-text font-semibold">Repository URL</span>',w,k,y,I,D='<span class="label-text-alt">Format: owner/repo (required)</span>',H,U,N,j='<span class="label-text font-semibold">Branch</span>',B,C,L,A,O='<span class="label-text-alt">Branch containing the archives</span>',G,q,J,de='<span class="label-text font-semibold">Personal Access Token (Optional)</span>',be,R,F,W,ve=`<span class="label-text-alt">Required for private repositories.
								<a href="https://github.com/settings/tokens/new?scopes=repo&amp;description=Discord%20Archive%20Viewer" target="_blank" rel="noopener noreferrer" class="link link-primary">Create a token</a> with &quot;Contents: Read&quot; permission.</span>`,he,se,ee,oe,pe,Ce,ie,qe,ce,Ve=r[0]?"Continue":"Save Settings",je,Oe,Ye,lt;function nt(le,Q){return le[0]?vs:bs}let Ge=nt(r),ue=Ge(r);function at(le,Q){return le[3]?ms:_s}let Re=at(r),fe=Re(r),x=r[4]&&gt(r),Y=!r[0]&&wt(r);return{c(){t=m("div"),e=m("div"),s=m("div"),l=m("h2"),n=V(a),o=T(),u=m("p"),ue.c(),d=T(),f=m("div"),b=m("div"),g=m("div"),v=m("label"),v.innerHTML=p,w=T(),k=m("input"),y=T(),I=m("label"),I.innerHTML=D,H=T(),U=m("div"),N=m("label"),N.innerHTML=j,B=T(),C=m("input"),L=T(),A=m("label"),A.innerHTML=O,G=T(),q=m("div"),J=m("label"),J.innerHTML=de,be=T(),R=m("input"),F=T(),W=m("label"),W.innerHTML=ve,he=T(),se=m("div"),ee=m("button"),fe.c(),pe=T(),x&&x.c(),Ce=T(),ie=m("div"),Y&&Y.c(),qe=T(),ce=m("button"),je=V(Ve),this.h()},l(le){t=_(le,"DIV",{class:!0,role:!0,"aria-labelledby":!0,"aria-modal":!0});var Q=E(t);e=_(Q,"DIV",{class:!0,role:!0});var Se=E(e);s=_(Se,"DIV",{class:!0});var Fe=E(s);l=_(Fe,"H2",{id:!0,class:!0});var ot=E(l);n=P(ot,a),ot.forEach(h),o=S(Fe),u=_(Fe,"P",{class:!0});var it=E(u);ue.l(it),it.forEach(h),Fe.forEach(h),d=S(Se),f=_(Se,"DIV",{class:!0});var ct=E(f);b=_(ct,"DIV",{class:!0});var ne=E(b);g=_(ne,"DIV",{class:!0});var Te=E(g);v=_(Te,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),z(v)!=="svelte-iz5g48"&&(v.innerHTML=p),w=S(Te),k=_(Te,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),y=S(Te),I=_(Te,"LABEL",{class:!0,"data-svelte-h":!0}),z(I)!=="svelte-1yx6mvd"&&(I.innerHTML=D),Te.forEach(h),H=S(ne),U=_(ne,"DIV",{class:!0});var Ue=E(U);N=_(Ue,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),z(N)!=="svelte-1c9quyv"&&(N.innerHTML=j),B=S(Ue),C=_(Ue,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),L=S(Ue),A=_(Ue,"LABEL",{class:!0,"data-svelte-h":!0}),z(A)!=="svelte-ojxzbw"&&(A.innerHTML=O),Ue.forEach(h),G=S(ne),q=_(ne,"DIV",{class:!0});var Ae=E(q);J=_(Ae,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),z(J)!=="svelte-jb5ldi"&&(J.innerHTML=de),be=S(Ae),R=_(Ae,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),F=S(Ae),W=_(Ae,"LABEL",{class:!0,"data-svelte-h":!0}),z(W)!=="svelte-1u0o83"&&(W.innerHTML=ve),Ae.forEach(h),he=S(ne),se=_(ne,"DIV",{class:!0});var ut=E(se);ee=_(ut,"BUTTON",{class:!0});var ft=E(ee);fe.l(ft),ft.forEach(h),ut.forEach(h),pe=S(ne),x&&x.l(ne),ne.forEach(h),ct.forEach(h),Ce=S(Se),ie=_(Se,"DIV",{class:!0});var ze=E(ie);Y&&Y.l(ze),qe=S(ze),ce=_(ze,"BUTTON",{class:!0});var dt=E(ce);je=P(dt,Ve),dt.forEach(h),ze.forEach(h),Se.forEach(h),Q.forEach(h),this.h()},h(){c(l,"id","settings-title"),c(l,"class","text-2xl font-bold"),c(u,"class","text-sm text-base-content/70 mt-1"),c(s,"class","border-b border-base-300 p-6"),c(v,"class","label"),c(v,"for","repo-url"),c(k,"id","repo-url"),c(k,"type","text"),c(k,"placeholder","owner/repo (e.g., palaima/discord-archives)"),c(k,"class","input input-bordered w-full"),k.required=!0,c(I,"class","label"),c(g,"class","form-control"),c(N,"class","label"),c(N,"for","branch"),c(C,"id","branch"),c(C,"type","text"),c(C,"placeholder","main"),c(C,"class","input input-bordered w-full"),c(A,"class","label"),c(U,"class","form-control"),c(J,"class","label"),c(J,"for","pat"),c(R,"id","pat"),c(R,"type","password"),c(R,"placeholder","github_pat_xxxxx..."),c(R,"class","input input-bordered w-full font-mono text-sm"),c(W,"class","label"),c(q,"class","form-control"),c(ee,"class","btn btn-outline btn-sm"),ee.disabled=oe=r[3]||!r[2].repoUrl,c(se,"class","form-control"),c(b,"class","space-y-4"),c(f,"class","p-6 space-y-6"),c(ce,"class","btn btn-primary"),ce.disabled=Oe=!r[2].repoUrl,c(ie,"class","border-t border-base-300 p-6 flex justify-end gap-3"),c(e,"class","bg-base-200 rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"),c(e,"role","document"),c(t,"class","fixed inset-0 bg-black bg-opacity-50 z-40 flex items-center justify-center"),c(t,"role","dialog"),c(t,"aria-labelledby","settings-title"),c(t,"aria-modal","true")},m(le,Q){M(le,t,Q),i(t,e),i(e,s),i(s,l),i(l,n),i(s,o),i(s,u),ue.m(u,null),i(e,d),i(e,f),i(f,b),i(b,g),i(g,v),i(g,w),i(g,k),ae(k,r[2].repoUrl),i(g,y),i(g,I),i(b,H),i(b,U),i(U,N),i(U,B),i(U,C),ae(C,r[2].branch),i(U,L),i(U,A),i(b,G),i(b,q),i(q,J),i(q,be),i(q,R),ae(R,r[2].pat),i(q,F),i(q,W),i(b,he),i(b,se),i(se,ee),fe.m(ee,null),i(b,pe),x&&x.m(b,null),i(e,Ce),i(e,ie),Y&&Y.m(ie,null),i(ie,qe),i(ie,ce),i(ce,je),Ye||(lt=[K(k,"input",r[11]),K(C,"input",r[12]),K(R,"input",r[13]),K(ee,"click",r[7]),K(ce,"click",r[5]),K(e,"click",Nt(r[10])),K(e,"keydown",r[8]),K(t,"click",function(){qt(r[0]?void 0:r[6])&&(r[0]?void 0:r[6]).apply(this,arguments)})],Ye=!0)},p(le,Q){r=le,Q&1&&a!==(a=r[0]?"GitHub Configuration Required":"GitHub Repository Settings")&&Z(n,a),Ge!==(Ge=nt(r))&&(ue.d(1),ue=Ge(r),ue&&(ue.c(),ue.m(u,null))),Q&4&&k.value!==r[2].repoUrl&&ae(k,r[2].repoUrl),Q&4&&C.value!==r[2].branch&&ae(C,r[2].branch),Q&4&&R.value!==r[2].pat&&ae(R,r[2].pat),Re!==(Re=at(r))&&(fe.d(1),fe=Re(r),fe&&(fe.c(),fe.m(ee,null))),Q&12&&oe!==(oe=r[3]||!r[2].repoUrl)&&(ee.disabled=oe),r[4]?x?x.p(r,Q):(x=gt(r),x.c(),x.m(b,null)):x&&(x.d(1),x=null),r[0]?Y&&(Y.d(1),Y=null):Y?Y.p(r,Q):(Y=wt(r),Y.c(),Y.m(ie,qe)),Q&1&&Ve!==(Ve=r[0]?"Continue":"Save Settings")&&Z(je,Ve),Q&4&&Oe!==(Oe=!r[2].repoUrl)&&(ce.disabled=Oe)},d(le){le&&h(t),ue.d(),fe.d(),x&&x.d(),Y&&Y.d(),Ye=!1,tt(lt)}}}function bs(r){let t;return{c(){t=V("Configure the GitHub repository where your encrypted archives are stored")},l(e){t=P(e,"Configure the GitHub repository where your encrypted archives are stored")},m(e,s){M(e,t,s)},d(e){e&&h(t)}}}function vs(r){let t;return{c(){t=V("Configure your GitHub repository to get started. This is required to load archives.")},l(e){t=P(e,"Configure your GitHub repository to get started. This is required to load archives.")},m(e,s){M(e,t,s)},d(e){e&&h(t)}}}function _s(r){let t;return{c(){t=V("Test Connection")},l(e){t=P(e,"Test Connection")},m(e,s){M(e,t,s)},d(e){e&&h(t)}}}function ms(r){let t,e;return{c(){t=m("span"),e=V(`
								Testing...`),this.h()},l(s){t=_(s,"SPAN",{class:!0}),E(t).forEach(h),e=P(s,`
								Testing...`),this.h()},h(){c(t,"class","loading loading-spinner loading-sm")},m(s,l){M(s,t,l),M(s,e,l)},d(s){s&&(h(t),h(e))}}}function gt(r){let t,e,s,l=r[4].success?"Success":"Error",a,n,o,u=r[4].message+"",d;return{c(){t=m("div"),e=m("div"),s=m("span"),a=V(l),n=T(),o=m("p"),d=V(u),this.h()},l(f){t=_(f,"DIV",{class:!0});var b=E(t);e=_(b,"DIV",{});var g=E(e);s=_(g,"SPAN",{class:!0});var v=E(s);a=P(v,l),v.forEach(h),n=S(g),o=_(g,"P",{class:!0});var p=E(o);d=P(p,u),p.forEach(h),g.forEach(h),b.forEach(h),this.h()},h(){c(s,"class","font-semibold"),c(o,"class","text-sm"),c(t,"class","alert"),$(t,"alert-success",r[4].success),$(t,"alert-error",!r[4].success)},m(f,b){M(f,t,b),i(t,e),i(e,s),i(s,a),i(e,n),i(e,o),i(o,d)},p(f,b){b&16&&l!==(l=f[4].success?"Success":"Error")&&Z(a,l),b&16&&u!==(u=f[4].message+"")&&Z(d,u),b&16&&$(t,"alert-success",f[4].success),b&16&&$(t,"alert-error",!f[4].success)},d(f){f&&h(t)}}}function wt(r){let t,e="Cancel",s,l;return{c(){t=m("button"),t.textContent=e,this.h()},l(a){t=_(a,"BUTTON",{class:!0,"data-svelte-h":!0}),z(t)!=="svelte-121k3bn"&&(t.textContent=e),this.h()},h(){c(t,"class","btn btn-ghost")},m(a,n){M(a,t,n),s||(l=K(t,"click",r[6]),s=!0)},p:te,d(a){a&&h(t),s=!1,l()}}}function gs(r){let t,e=r[1]&&mt(r);return{c(){e&&e.c(),t=De()},l(s){e&&e.l(s),t=De()},m(s,l){e&&e.m(s,l),M(s,t,l)},p(s,[l]){s[1]?e?e.p(s,l):(e=mt(s),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null)},i:te,o:te,d(s){s&&h(t),e&&e.d(s)}}}function ws(r,t,e){let s;we(r,Ze,H=>e(14,s=H));const l=Be();let{required:a=!1}=t,n=!1,o=s,u=!1,d=null;function f(){e(1,n=!0),e(2,o={...s}),e(4,d=null)}function b(){e(1,n=!1),l("close")}function g(){Ze.set(o),b()}function v(){a||(e(2,o={...s}),b())}async function p(){if(!o.repoUrl){e(4,d={success:!1,message:"Please enter a repository URL"});return}e(3,u=!0),e(4,d=null);try{await new rt(o).testConnection()?e(4,d={success:!0,message:"Connection successful! Metadata file found."}):e(4,d={success:!1,message:"Connection failed. Check repository URL and permissions."})}catch(H){e(4,d={success:!1,message:H instanceof Error?H.message:"Unknown error occurred"})}finally{e(3,u=!1)}}function w(H){H.key==="Escape"&&!a&&v()}function k(H){Bt.call(this,r,H)}function y(){o.repoUrl=this.value,e(2,o),e(1,n)}function I(){o.branch=this.value,e(2,o),e(1,n)}function D(){o.pat=this.value,e(2,o),e(1,n)}return r.$$set=H=>{"required"in H&&e(0,a=H.required)},r.$$.update=()=>{r.$$.dirty&6&&n&&!o.repoUrl&&Le.github.repoUrl&&e(2,o={...o,repoUrl:Le.github.repoUrl,branch:Le.github.branch,pat:Le.github.pat})},[a,n,o,u,d,g,v,p,w,f,k,y,I,D]}class ks extends ye{constructor(t){super(),Ee(this,t,ws,gs,ke,{required:0,open:9})}get open(){return this.$$.ctx[9]}}function ys(r){let t,e,s,l,a="Discord Archives",n,o,u='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>',d,f,b,g,v=r[0].totalArchives+"",p,w,k,y,I,D=r[0].uniqueServers+"",H,U,N,j,B,C=r[0].uniqueChannels+"",L,A,O,G,q,J,de;const be=r[3].default,R=jt(be,r,r[2],null);return{c(){t=m("div"),e=m("div"),s=m("div"),l=m("h1"),l.textContent=a,n=T(),o=m("button"),o.innerHTML=u,d=T(),f=m("div"),b=m("div"),g=V("ðŸ“ "),p=V(v),w=V(" archives"),k=T(),y=m("div"),I=V("ðŸ–¥ï¸ "),H=V(D),U=V(" servers"),N=T(),j=m("div"),B=V("ðŸ’¬ "),L=V(C),A=V(" channels"),O=T(),G=m("div"),R&&R.c(),this.h()},l(F){t=_(F,"DIV",{class:!0});var W=E(t);e=_(W,"DIV",{class:!0});var ve=E(e);s=_(ve,"DIV",{class:!0});var he=E(s);l=_(he,"H1",{class:!0,"data-svelte-h":!0}),z(l)!=="svelte-176jj07"&&(l.textContent=a),n=S(he),o=_(he,"BUTTON",{class:!0,title:!0,"aria-label":!0,"data-svelte-h":!0}),z(o)!=="svelte-9lg1f1"&&(o.innerHTML=u),he.forEach(h),d=S(ve),f=_(ve,"DIV",{class:!0});var se=E(f);b=_(se,"DIV",{});var ee=E(b);g=P(ee,"ðŸ“ "),p=P(ee,v),w=P(ee," archives"),ee.forEach(h),k=S(se),y=_(se,"DIV",{});var oe=E(y);I=P(oe,"ðŸ–¥ï¸ "),H=P(oe,D),U=P(oe," servers"),oe.forEach(h),N=S(se),j=_(se,"DIV",{});var pe=E(j);B=P(pe,"ðŸ’¬ "),L=P(pe,C),A=P(pe," channels"),pe.forEach(h),se.forEach(h),ve.forEach(h),O=S(W),G=_(W,"DIV",{class:!0});var Ce=E(G);R&&R.l(Ce),Ce.forEach(h),W.forEach(h),this.h()},h(){c(l,"class","text-xl font-semibold"),c(o,"class","btn btn-ghost btn-sm btn-square"),c(o,"title","Settings"),c(o,"aria-label","Open settings"),c(s,"class","flex items-center justify-between mb-3"),c(f,"class","text-sm space-y-1 text-base-content/70"),c(e,"class","p-5 bg-base-300 border-b border-base-100"),c(G,"class","flex-1 overflow-y-auto p-3"),c(t,"class","w-80 bg-base-200 border-r border-base-300 flex flex-col h-screen")},m(F,W){M(F,t,W),i(t,e),i(e,s),i(s,l),i(s,n),i(s,o),i(e,d),i(e,f),i(f,b),i(b,g),i(b,p),i(b,w),i(f,k),i(f,y),i(y,I),i(y,H),i(y,U),i(f,N),i(f,j),i(j,B),i(j,L),i(j,A),i(t,O),i(t,G),R&&R.m(G,null),q=!0,J||(de=K(o,"click",r[1]),J=!0)},p(F,[W]){(!q||W&1)&&v!==(v=F[0].totalArchives+"")&&Z(p,v),(!q||W&1)&&D!==(D=F[0].uniqueServers+"")&&Z(H,D),(!q||W&1)&&C!==(C=F[0].uniqueChannels+"")&&Z(L,C),R&&R.p&&(!q||W&4)&&Ot(R,be,F,F[2],q?Rt(be,F[2],W,null):Gt(F[2]),null)},i(F){q||(X(R,F),q=!0)},o(F){re(R,F),q=!1},d(F){F&&h(t),R&&R.d(F),J=!1,de()}}}function Es(r,t,e){let s;we(r,Xt,u=>e(0,s=u));let{$$slots:l={},$$scope:a}=t;const n=Be();function o(){n("openSettings")}return r.$$set=u=>{"$$scope"in u&&e(2,a=u.$$scope)},[s,o,a,l]}class Cs extends ye{constructor(t){super(),Ee(this,t,Es,ys,ke,{})}}function kt(r,t,e){const s=r.slice();return s[6]=t[e],s}function yt(r){let t,e=Je(r[1].channels),s=[];for(let l=0;l<e.length;l+=1)s[l]=Et(kt(r,e,l));return{c(){t=m("div");for(let l=0;l<s.length;l+=1)s[l].c();this.h()},l(l){t=_(l,"DIV",{class:!0});var a=E(t);for(let n=0;n<s.length;n+=1)s[n].l(a);a.forEach(h),this.h()},h(){c(t,"class","pl-3 mt-2 space-y-1")},m(l,a){M(l,t,a);for(let n=0;n<s.length;n+=1)s[n]&&s[n].m(t,null)},p(l,a){if(a&10){e=Je(l[1].channels);let n;for(n=0;n<e.length;n+=1){const o=kt(l,e,n);s[n]?s[n].p(o,a):(s[n]=Et(o),s[n].c(),s[n].m(t,null))}for(;n<s.length;n+=1)s[n].d(1);s.length=e.length}},d(l){l&&h(t),Lt(s,l)}}}function Et(r){let t,e,s="#",l,a,n=(r[6].channel_name||r[6].channel_id)+"",o,u,d,f=new Date(r[6].exported_at).toLocaleDateString()+"",b,g,v,p;function w(){return r[4](r[6])}return{c(){t=m("button"),e=m("span"),e.textContent=s,l=T(),a=m("span"),o=V(n),u=T(),d=m("span"),b=V(f),g=T(),this.h()},l(k){t=_(k,"BUTTON",{class:!0});var y=E(t);e=_(y,"SPAN",{class:!0,"data-svelte-h":!0}),z(e)!=="svelte-ulfyf0"&&(e.textContent=s),l=S(y),a=_(y,"SPAN",{class:!0});var I=E(a);o=P(I,n),I.forEach(h),u=S(y),d=_(y,"SPAN",{class:!0});var D=E(d);b=P(D,f),D.forEach(h),g=S(y),y.forEach(h),this.h()},h(){c(e,"class","text-base-content/50 group-hover:text-base-content"),c(a,"class","flex-1"),c(d,"class","text-xs text-base-content/40"),c(t,"class","w-full px-3 py-2 rounded hover:bg-base-100 transition-colors flex items-center gap-2 text-sm text-left group")},m(k,y){M(k,t,y),i(t,e),i(t,l),i(t,a),i(a,o),i(t,u),i(t,d),i(d,b),i(t,g),v||(p=K(t,"click",w),v=!0)},p(k,y){r=k,y&2&&n!==(n=(r[6].channel_name||r[6].channel_id)+"")&&Z(o,n),y&2&&f!==(f=new Date(r[6].exported_at).toLocaleDateString()+"")&&Z(b,f)},d(k){k&&h(t),v=!1,p()}}}function Ss(r){let t,e,s,l="â–¼",a,n,o=r[1].name+"",u,d,f,b,g=!r[0]&&yt(r);return{c(){t=m("div"),e=m("button"),s=m("span"),s.textContent=l,a=T(),n=m("span"),u=V(o),d=T(),g&&g.c(),this.h()},l(v){t=_(v,"DIV",{class:!0});var p=E(t);e=_(p,"BUTTON",{class:!0});var w=E(e);s=_(w,"SPAN",{class:!0,"data-svelte-h":!0}),z(s)!=="svelte-1nry6l9"&&(s.textContent=l),a=S(w),n=_(w,"SPAN",{});var k=E(n);u=P(k,o),k.forEach(h),w.forEach(h),d=S(p),g&&g.l(p),p.forEach(h),this.h()},h(){c(s,"class","transform transition-transform text-xs"),$(s,"rotate-0",!r[0]),$(s,"-rotate-90",r[0]),c(e,"class","w-full px-3 py-2 bg-base-300 rounded hover:bg-base-100 transition-colors flex items-center gap-2 font-semibold text-sm"),c(t,"class","mb-4")},m(v,p){M(v,t,p),i(t,e),i(e,s),i(e,a),i(e,n),i(n,u),i(t,d),g&&g.m(t,null),f||(b=K(e,"click",r[2]),f=!0)},p(v,[p]){p&1&&$(s,"rotate-0",!v[0]),p&1&&$(s,"-rotate-90",v[0]),p&2&&o!==(o=v[1].name+"")&&Z(u,o),v[0]?g&&(g.d(1),g=null):g?g.p(v,p):(g=yt(v),g.c(),g.m(t,null))},i:te,o:te,d(v){v&&h(t),g&&g.d(),f=!1,b()}}}function Ts(r,t,e){let{server:s}=t,{collapsed:l=!1}=t;const a=Be();function n(){e(0,l=!l)}function o(d){a("selectChannel",d)}const u=d=>o(d);return r.$$set=d=>{"server"in d&&e(1,s=d.server),"collapsed"in d&&e(0,l=d.collapsed)},[l,s,n,o,u]}class Us extends ye{constructor(t){super(),Ee(this,t,Ts,Ss,ke,{server:1,collapsed:0})}}function As(r){let t,e="Welcome",s,l,a="Select a channel to view";return{c(){t=m("h2"),t.textContent=e,s=T(),l=m("div"),l.textContent=a,this.h()},l(n){t=_(n,"H2",{class:!0,"data-svelte-h":!0}),z(t)!=="svelte-qeexzb"&&(t.textContent=e),s=S(n),l=_(n,"DIV",{class:!0,"data-svelte-h":!0}),z(l)!=="svelte-563yit"&&(l.textContent=a),this.h()},h(){c(t,"class","text-lg font-semibold"),c(l,"class","text-sm text-base-content/60")},m(n,o){M(n,t,o),M(n,s,o),M(n,l,o)},p:te,d(n){n&&(h(t),h(s),h(l))}}}function Ls(r){let t,e,s=(r[0].channel_name||r[0].channel_id)+"",l,a,n=r[0].export_path.endsWith(".enc"),o,u,d,f=new Date(r[0].exported_at).toLocaleString()+"",b,g,v=r[0].format.toUpperCase()+"",p,w=n&&Ct();return{c(){t=m("div"),e=m("h2"),l=V(s),a=T(),w&&w.c(),o=T(),u=m("div"),d=V("Latest export: "),b=V(f),g=V(" â€¢ "),p=V(v),this.h()},l(k){t=_(k,"DIV",{class:!0});var y=E(t);e=_(y,"H2",{class:!0});var I=E(e);l=P(I,s),a=S(I),w&&w.l(I),I.forEach(h),y.forEach(h),o=S(k),u=_(k,"DIV",{class:!0});var D=E(u);d=P(D,"Latest export: "),b=P(D,f),g=P(D," â€¢ "),p=P(D,v),D.forEach(h),this.h()},h(){c(e,"class","text-lg font-semibold"),c(t,"class","flex items-center gap-2"),c(u,"class","text-sm text-base-content/60 mt-1")},m(k,y){M(k,t,y),i(t,e),i(e,l),i(e,a),w&&w.m(e,null),M(k,o,y),M(k,u,y),i(u,d),i(u,b),i(u,g),i(u,p)},p(k,y){y&1&&s!==(s=(k[0].channel_name||k[0].channel_id)+"")&&Z(l,s),y&1&&(n=k[0].export_path.endsWith(".enc")),n?w||(w=Ct(),w.c(),w.m(e,null)):w&&(w.d(1),w=null),y&1&&f!==(f=new Date(k[0].exported_at).toLocaleString()+"")&&Z(b,f),y&1&&v!==(v=k[0].format.toUpperCase()+"")&&Z(p,v)},d(k){k&&(h(t),h(o),h(u)),w&&w.d()}}}function Ct(r){let t,e="ðŸ”’";return{c(){t=m("span"),t.textContent=e,this.h()},l(s){t=_(s,"SPAN",{class:!0,"data-svelte-h":!0}),z(t)!=="svelte-1cny2mi"&&(t.textContent=e),this.h()},h(){c(t,"class","ml-2")},m(s,l){M(s,t,l)},d(s){s&&h(t)}}}function Ds(r){let t,e='<div class="text-6xl mb-4">ðŸ“–</div> <div class="text-lg">Select a channel from the sidebar to start browsing</div>';return{c(){t=m("div"),t.innerHTML=e,this.h()},l(s){t=_(s,"DIV",{class:!0,"data-svelte-h":!0}),z(t)!=="svelte-1qodbfi"&&(t.innerHTML=e),this.h()},h(){c(t,"class","flex flex-col items-center justify-center h-full text-base-content/40")},m(s,l){M(s,t,l)},p:te,d(s){s&&h(t)}}}function Is(r){let t,e;return{c(){t=m("iframe"),this.h()},l(s){t=_(s,"IFRAME",{src:!0,title:!0,class:!0}),E(t).forEach(h),this.h()},h(){ht(t.src,e=r[1])||c(t,"src",e),c(t,"title","Archive viewer"),c(t,"class","w-full h-full border-0")},m(s,l){M(s,t,l)},p(s,l){l&2&&!ht(t.src,e=s[1])&&c(t,"src",e)},d(s){s&&h(t)}}}function Ms(r){let t,e='<div class="loading loading-spinner loading-lg"></div>';return{c(){t=m("div"),t.innerHTML=e,this.h()},l(s){t=_(s,"DIV",{class:!0,"data-svelte-h":!0}),z(t)!=="svelte-1urjiaz"&&(t.innerHTML=e),this.h()},h(){c(t,"class","flex items-center justify-center h-full")},m(s,l){M(s,t,l)},p:te,d(s){s&&h(t)}}}function Hs(r){let t,e,s,l;function a(b,g){return b[0]?Ls:As}let n=a(r),o=n(r);function u(b,g){return b[2]?Ms:b[1]?Is:Ds}let d=u(r),f=d(r);return{c(){t=m("div"),e=m("div"),o.c(),s=T(),l=m("div"),f.c(),this.h()},l(b){t=_(b,"DIV",{class:!0});var g=E(t);e=_(g,"DIV",{class:!0});var v=E(e);o.l(v),v.forEach(h),s=S(g),l=_(g,"DIV",{class:!0});var p=E(l);f.l(p),p.forEach(h),g.forEach(h),this.h()},h(){c(e,"class","p-4 bg-base-200 border-b border-base-300"),c(l,"class","flex-1 overflow-hidden"),c(t,"class","flex-1 flex flex-col bg-base-100")},m(b,g){M(b,t,g),i(t,e),o.m(e,null),i(t,s),i(t,l),f.m(l,null)},p(b,[g]){n===(n=a(b))&&o?o.p(b,g):(o.d(1),o=n(b),o&&(o.c(),o.m(e,null))),d===(d=u(b))&&f?f.p(b,g):(f.d(1),f=d(b),f&&(f.c(),f.m(l,null)))},i:te,o:te,d(b){b&&h(t),o.d(),f.d()}}}function Ps(r,t,e){let{archive:s=null}=t,{blobUrl:l=null}=t,{isLoading:a=!1}=t;return r.$$set=n=>{"archive"in n&&e(0,s=n.archive),"blobUrl"in n&&e(1,l=n.blobUrl),"isLoading"in n&&e(2,a=n.isLoading)},[s,l,a]}class Vs extends ye{constructor(t){super(),Ee(this,t,Ps,Hs,ke,{archive:0,blobUrl:1,isLoading:2})}}function St(r,t,e){const s=r.slice();return s[18]=t[e],s}function Tt(r){let t,e;return t=new fs({}),t.$on("openSettings",r[11]),{c(){Pe(t.$$.fragment)},l(s){He(t.$$.fragment,s)},m(s,l){Me(t,s,l),e=!0},p:te,i(s){e||(X(t.$$.fragment,s),e=!0)},o(s){re(t.$$.fragment,s),e=!1},d(s){Ie(t,s)}}}function Ut(r){let t,e,s,l;return t=new Cs({props:{$$slots:{default:[Ns]},$$scope:{ctx:r}}}),t.$on("openSettings",r[11]),s=new Vs({props:{archive:r[3],blobUrl:r[4],isLoading:r[5]}}),{c(){Pe(t.$$.fragment),e=T(),Pe(s.$$.fragment)},l(a){He(t.$$.fragment,a),e=S(a),He(s.$$.fragment,a)},m(a,n){Me(t,a,n),M(a,e,n),Me(s,a,n),l=!0},p(a,n){const o={};n&2097408&&(o.$$scope={dirty:n,ctx:a}),t.$set(o);const u={};n&8&&(u.archive=a[3]),n&16&&(u.blobUrl=a[4]),n&32&&(u.isLoading=a[5]),s.$set(u)},i(a){l||(X(t.$$.fragment,a),X(s.$$.fragment,a),l=!0)},o(a){re(t.$$.fragment,a),re(s.$$.fragment,a),l=!1},d(a){a&&h(e),Ie(t,a),Ie(s,a)}}}function At(r){let t,e;return t=new Us({props:{server:r[18]}}),t.$on("selectChannel",r[9]),{c(){Pe(t.$$.fragment)},l(s){He(t.$$.fragment,s)},m(s,l){Me(t,s,l),e=!0},p(s,l){const a={};l&256&&(a.server=s[18]),t.$set(a)},i(s){e||(X(t.$$.fragment,s),e=!0)},o(s){re(t.$$.fragment,s),e=!1},d(s){Ie(t,s)}}}function Ns(r){let t,e,s=Je(r[8]),l=[];for(let n=0;n<s.length;n+=1)l[n]=At(St(r,s,n));const a=n=>re(l[n],1,1,()=>{l[n]=null});return{c(){for(let n=0;n<l.length;n+=1)l[n].c();t=De()},l(n){for(let o=0;o<l.length;o+=1)l[o].l(n);t=De()},m(n,o){for(let u=0;u<l.length;u+=1)l[u]&&l[u].m(n,o);M(n,t,o),e=!0},p(n,o){if(o&768){s=Je(n[8]);let u;for(u=0;u<s.length;u+=1){const d=St(n,s,u);l[u]?(l[u].p(d,o),X(l[u],1)):(l[u]=At(d),l[u].c(),X(l[u],1),l[u].m(t.parentNode,t))}for($e(),u=s.length;u<l.length;u+=1)a(u);Xe()}},i(n){if(!e){for(let o=0;o<s.length;o+=1)X(l[o]);e=!0}},o(n){l=l.filter(Boolean);for(let o=0;o<l.length;o+=1)re(l[o]);e=!1},d(n){n&&h(t),Lt(l,n)}}}function Bs(r){let t,e,s,l,a,n,o,u,d,f=!r[2].isUnlocked&&r[1]&&Tt(r);function b(w){r[14](w)}let g={archive:r[7]};r[6]!==void 0&&(g.show=r[6]),l=new ps({props:g}),Dt.push(()=>Kt(l,"show",b)),l.$on("unlock",r[10]);let v={required:!r[1]&&!r[2].isUnlocked};o=new ks({props:v}),r[15](o);let p=r[2].isUnlocked&&Ut(r);return{c(){t=T(),e=m("div"),f&&f.c(),s=T(),Pe(l.$$.fragment),n=T(),Pe(o.$$.fragment),u=T(),p&&p.c(),this.h()},l(w){zt("svelte-1nkvhcm",document.head).forEach(h),t=S(w),e=_(w,"DIV",{class:!0});var y=E(e);f&&f.l(y),s=S(y),He(l.$$.fragment,y),n=S(y),He(o.$$.fragment,y),u=S(y),p&&p.l(y),y.forEach(h),this.h()},h(){document.title="Discord Archive Browser",c(e,"class","flex h-screen overflow-hidden")},m(w,k){M(w,t,k),M(w,e,k),f&&f.m(e,null),i(e,s),Me(l,e,null),i(e,n),Me(o,e,null),i(e,u),p&&p.m(e,null),d=!0},p(w,[k]){!w[2].isUnlocked&&w[1]?f?(f.p(w,k),k&6&&X(f,1)):(f=Tt(w),f.c(),X(f,1),f.m(e,s)):f&&($e(),re(f,1,1,()=>{f=null}),Xe());const y={};k&128&&(y.archive=w[7]),!a&&k&64&&(a=!0,y.show=w[6],Ft(()=>a=!1)),l.$set(y);const I={};k&6&&(I.required=!w[1]&&!w[2].isUnlocked),o.$set(I),w[2].isUnlocked?p?(p.p(w,k),k&4&&X(p,1)):(p=Ut(w),p.c(),X(p,1),p.m(e,null)):p&&($e(),re(p,1,1,()=>{p=null}),Xe())},i(w){d||(X(f),X(l.$$.fragment,w),X(o.$$.fragment,w),X(p),d=!0)},o(w){re(f),re(l.$$.fragment,w),re(o.$$.fragment,w),re(p),d=!1},d(w){w&&(h(t),h(e)),f&&f.d(),Ie(l),r[15](null),Ie(o),p&&p.d()}}}function qs(r,t,e){let s,l,a,n,o;we(r,Ze,U=>e(13,a=U)),we(r,_e,U=>e(2,n=U)),we(r,Qt,U=>e(8,o=U));let u=null,d=null,f=!1,b=!1,g=null,v,p=!1;async function w(U){const N=U.detail;if(e(3,u=N),N.export_path.endsWith(".enc")){const j=Mt.get(N.secret_hint);j?await y(N,j):(e(7,g=N),e(6,b=!0))}else e(4,d=N.export_path)}async function k(U){const{archive:N,password:j}=U.detail;await y(N,j),e(6,b=!1)}async function y(U,N){e(5,f=!0);try{const j=await os(U.export_path,N,l);d&&d.startsWith("blob:")&&URL.revokeObjectURL(d),e(4,d=is(j,U))}catch(j){console.error("Failed to load encrypted archive:",j);const B=j instanceof Error?j.message:"The file may be corrupted.";alert(`Failed to decrypt and load archive: ${B}`)}finally{e(5,f=!1)}}function I(){v.open()}function D(U){b=U,e(6,b)}function H(U){Dt[U?"unshift":"push"](()=>{v=U,e(0,v)})}return r.$$.update=()=>{r.$$.dirty&8192&&e(1,s=!!a.repoUrl),r.$$.dirty&4103&&!s&&!n.isUnlocked&&!p&&(e(12,p=!0),setTimeout(()=>v?.open(),100)),r.$$.dirty&8192&&(l=new rt(a))},[v,s,n,u,d,f,b,g,o,w,k,I,p,a,D,H]}class zs extends ye{constructor(t){super(),Ee(this,t,qs,Bs,ke,{})}}export{zs as component,Fs as universal};
