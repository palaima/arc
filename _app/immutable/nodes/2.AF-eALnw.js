var Pt=Object.defineProperty;var Vt=(r,e,t)=>e in r?Pt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Ke=(r,e,t)=>Vt(r,typeof e!="symbol"?e+"":e,t);import{s as ke,n as te,d as h,r as tt,P as ae,Q as $,e as J,f as H,h as i,R as K,A as c,j as m,k as E,S as z,m as C,T as _e,l as P,o as _,p as T,U as ge,t as V,q as we,V as Be,v as De,W as Nt,X as Bt,i as qt,c as Ft,u as jt,g as Gt,b as Ot,Y as At,Z as ht,C as Dt,_ as Rt,$ as zt}from"../chunks/Ct-DdQaZ.js";import{S as ye,i as Ee,t as re,a as X,f as Kt,d as Ie,c as Xe,m as He,e as Me,b as Pe,g as $e}from"../chunks/DldV-x9j.js";import{w as Ze,d as It}from"../chunks/Bs7vbK-S.js";function xe(r){return r?.length!==void 0?r:Array.from(r)}const Wt=!0,xt=!1,Rs=Object.freeze(Object.defineProperty({__proto__:null,prerender:Wt,ssr:xt},Symbol.toStringTag,{value:"Module"}));function Jt(){const{subscribe:r,set:e,update:t}=Ze({isUnlocked:!1,masterPassword:null,error:null});return{subscribe:r,unlock:s=>{t(l=>({...l,isUnlocked:!0,masterPassword:s,error:null}))},setError:s=>{t(l=>({...l,error:s}))},clearError:()=>{t(s=>({...s,error:null}))},reset:()=>{e({isUnlocked:!1,masterPassword:null,error:null})}}}const me=Jt();function Zt(){const{subscribe:r,set:e,update:t}=Ze(new Map);return{subscribe:r,add:(s,l)=>{t(a=>{const n=new Map(a);return n.set(s,l),n})},get:s=>{let l;return r(a=>{l=a.get(s)})(),l},has:s=>{let l=!1;return r(a=>{l=a.has(s)})(),l},clear:()=>{e(new Map)}}}const Ht=Zt();function Yt(){const{subscribe:r,set:e,update:t}=Ze({archives:[],isLoading:!1,error:null});return{subscribe:r,setArchives:s=>{e({archives:s,isLoading:!1,error:null})},setLoading:s=>{t(l=>({...l,isLoading:s}))},setError:s=>{t(l=>({...l,error:s,isLoading:!1}))},reset:()=>{e({archives:[],isLoading:!1,error:null})}}}const st=Yt(),Qt=It(st,r=>{if(!r.archives.length)return[];const e=new Map,t=new Map;return r.archives.forEach(s=>{const l=`${s.server_id}-${s.channel_id}`;t.has(l)||t.set(l,[]),t.get(l).push(s)}),t.forEach((s,l)=>{s.sort((o,u)=>new Date(u.exported_at).getTime()-new Date(o.exported_at).getTime());const a=s[0];e.has(a.server_id)||e.set(a.server_id,{id:a.server_id,name:a.server_name,channels:[]});const n={...a,versions:s,versionCount:s.length};e.get(a.server_id).channels.push(n)}),Array.from(e.values())}),Xt=It(st,r=>{const e=new Set(r.archives.map(s=>s.server_id)),t=new Set(r.archives.map(s=>s.channel_id));return{totalArchives:r.archives.length,uniqueServers:e.size,uniqueChannels:t.size}}),Ae={github:{repoUrl:void 0,branch:"main",pat:void 0}},et={repoUrl:"",branch:Ae.github.branch,pat:Ae.github.pat},We="discord-archiver-github-settings";function $t(){try{const r=localStorage.getItem(We);if(r){const e=JSON.parse(r);return{...et,...e}}}catch(r){console.error("Failed to load GitHub settings from localStorage:",r)}return et}function es(){const{subscribe:r,set:e,update:t}=Ze($t());return{subscribe:r,set:s=>{try{localStorage.setItem(We,JSON.stringify(s))}catch(l){console.error("Failed to save GitHub settings to localStorage:",l)}e(s)},update:s=>{t(l=>{const a=s(l);try{localStorage.setItem(We,JSON.stringify(a))}catch(n){console.error("Failed to save GitHub settings to localStorage:",n)}return a})},reset:()=>{try{localStorage.removeItem(We)}catch(s){console.error("Failed to remove GitHub settings from localStorage:",s)}e(et)}}}const Je=es(),ts=6e5;async function ss(r,e){const t=new TextEncoder,s=await crypto.subtle.importKey("raw",t.encode(r),"PBKDF2",!1,["deriveBits"]),l=await crypto.subtle.deriveBits({name:"PBKDF2",salt:e,iterations:ts,hash:"SHA-256"},s,256);return await crypto.subtle.importKey("raw",l,"AES-GCM",!1,["decrypt"])}async function rs(r){const t=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(s)).map(n=>n.toString(16).padStart(2,"0")).join("").substring(0,8)}async function ls(r,e){return await rs(r)===e}const Ne=8,Qe=12;async function Mt(r,e){if(r.length<Ne+Qe)throw new Error("Invalid encrypted data: too short");const t=r.slice(0,Ne),s=r.slice(Ne,Ne+Qe),l=r.slice(Ne+Qe),a=await ss(e,t),n=await crypto.subtle.decrypt({name:"AES-GCM",iv:s},a,l);return new Uint8Array(n)}async function ns(r,e){const t=await Mt(r,e),l=new TextDecoder().decode(t);return JSON.parse(l)}async function as(r,e){const t=await e.fetchMetadata();return await ns(t,r)}async function os(r,e,t){const s=await t.fetchArchive(r);return await Mt(s,e)}function is(r,e){const t=e.format==="html"||e.format.startsWith("html")?"text/html":e.format==="json"?"application/json":"text/plain",s=new Blob([r],{type:t});return URL.createObjectURL(s)}class rt{constructor(e){Ke(this,"repoUrl");Ke(this,"branch");Ke(this,"pat");this.repoUrl=e.repoUrl,this.branch=e.branch,this.pat=e.pat}isLFSPointer(e){return e.length<50?!1:new TextDecoder().decode(e.slice(0,50)).startsWith("version https://git-lfs.github.com")}async fetchFromLFS(e){const t=e.startsWith("/")?e.slice(1):e,s=`https://media.githubusercontent.com/media/${this.repoUrl}/${this.branch}/${t}`,l={};this.pat&&(l.Authorization=`token ${this.pat}`);const a=await fetch(s,{headers:l});if(!a.ok)throw a.status===404?new Error(`LFS file not found in GitHub storage: ${e}`):a.status===401||a.status===403?new Error("GitHub LFS authentication failed. Check your PAT or repository permissions."):new Error(`Failed to fetch LFS file from GitHub: ${a.status} ${a.statusText}`);const n=await a.arrayBuffer();return new Uint8Array(n)}async fetchFile(e){const t=e.startsWith("/")?e.slice(1):e,s=`https://api.github.com/repos/${this.repoUrl}/contents/${t}?ref=${this.branch}`,l={Accept:"application/vnd.github.v3.raw"};this.pat&&(l.Authorization=`token ${this.pat}`);const a=await fetch(s,{headers:l});if(!a.ok)throw a.status===404?new Error(`File not found in GitHub repository: ${e}`):a.status===401||a.status===403?new Error("GitHub authentication failed. Check your PAT or repository permissions."):new Error(`Failed to fetch file from GitHub: ${a.status} ${a.statusText}`);const n=await a.arrayBuffer(),o=new Uint8Array(n);return this.isLFSPointer(o)?(console.log(`[LFS] Detected pointer file for ${e}, fetching actual content from LFS storage...`),await this.fetchFromLFS(e)):o}async fetchMetadata(){return this.fetchFile(".archive_metadata.json.enc")}async fetchArchive(e){return this.fetchFile(e)}async testConnection(){try{return await this.fetchMetadata(),!0}catch(e){return console.error("GitHub connection test failed:",e),!1}}}function pt(r){let e,t,s,l,a,n;return{c(){e=_("div"),t=ge("svg"),s=ge("path"),l=T(),a=_("span"),n=V(r[2]),this.h()},l(o){e=m(o,"DIV",{class:!0});var u=E(e);t=_e(u,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0});var d=E(t);s=_e(d,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),E(s).forEach(h),d.forEach(h),l=C(u),a=m(u,"SPAN",{class:!0});var f=E(a);n=P(f,r[2]),f.forEach(h),u.forEach(h),this.h()},h(){c(s,"stroke-linecap","round"),c(s,"stroke-linejoin","round"),c(s,"stroke-width","2"),c(s,"d","M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"),c(t,"xmlns","http://www.w3.org/2000/svg"),c(t,"class","stroke-current shrink-0 h-6 w-6"),c(t,"fill","none"),c(t,"viewBox","0 0 24 24"),c(a,"class","text-sm"),c(e,"class","alert alert-error mb-3")},m(o,u){H(o,e,u),i(e,t),i(t,s),i(e,l),i(e,a),i(a,n)},p(o,u){u&4&&J(n,o[2])},d(o){o&&h(e)}}}function cs(r){let e,t,s,l="Master Password Required",a,n,o="Enter your master password to decrypt the archive metadata and browse your archives.",u,d,f,b,g,v,p,w,k,y,I,D,M=r[1]?"Unlocking...":"Unlock",U,N,F,B=r[2]&&pt(r);return{c(){e=_("dialog"),t=_("div"),s=_("h3"),s.textContent=l,a=T(),n=_("p"),n.textContent=o,u=T(),d=_("input"),f=T(),B&&B.c(),b=T(),g=_("div"),v=_("button"),p=ge("svg"),w=ge("path"),k=ge("path"),y=V(`
        Settings`),I=T(),D=_("button"),U=V(M),this.h()},l(S){e=m(S,"DIALOG",{class:!0});var A=E(e);t=m(A,"DIV",{class:!0});var L=E(t);s=m(L,"H3",{class:!0,"data-svelte-h":!0}),z(s)!=="svelte-12v7ilt"&&(s.textContent=l),a=C(L),n=m(L,"P",{class:!0,"data-svelte-h":!0}),z(n)!=="svelte-1nzkc2t"&&(n.textContent=o),u=C(L),d=m(L,"INPUT",{type:!0,placeholder:!0,class:!0}),f=C(L),B&&B.l(L),b=C(L),g=m(L,"DIV",{class:!0});var j=E(g);v=m(j,"BUTTON",{class:!0});var G=E(v);p=_e(G,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var q=E(p);w=_e(q,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),E(w).forEach(h),k=_e(q,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),E(k).forEach(h),q.forEach(h),y=P(G,`
        Settings`),G.forEach(h),I=C(j),D=m(j,"BUTTON",{class:!0});var x=E(D);U=P(x,M),x.forEach(h),j.forEach(h),L.forEach(h),A.forEach(h),this.h()},h(){c(s,"class","font-bold text-lg mb-2"),c(n,"class","text-sm text-base-content/70 mb-4"),c(d,"type","password"),c(d,"placeholder","Master password"),c(d,"class","input input-bordered w-full mb-3"),d.disabled=r[1],d.autofocus=!0,$(d,"input-error",r[2]),c(w,"stroke-linecap","round"),c(w,"stroke-linejoin","round"),c(w,"stroke-width","2"),c(w,"d","M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"),c(k,"stroke-linecap","round"),c(k,"stroke-linejoin","round"),c(k,"stroke-width","2"),c(k,"d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"),c(p,"xmlns","http://www.w3.org/2000/svg"),c(p,"class","h-4 w-4 mr-1"),c(p,"fill","none"),c(p,"viewBox","0 0 24 24"),c(p,"stroke","currentColor"),c(v,"class","btn btn-ghost btn-sm"),v.disabled=r[1],c(D,"class","btn btn-primary"),D.disabled=r[1],$(D,"loading",r[1]),c(g,"class","modal-action flex justify-between items-center"),c(t,"class","modal-box bg-base-200"),c(e,"class","modal modal-open")},m(S,A){H(S,e,A),i(e,t),i(t,s),i(t,a),i(t,n),i(t,u),i(t,d),ae(d,r[0]),i(t,f),B&&B.m(t,null),i(t,b),i(t,g),i(g,v),i(v,p),i(p,w),i(p,k),i(v,y),i(g,I),i(g,D),i(D,U),d.focus(),N||(F=[K(d,"input",r[8]),K(d,"keypress",r[4]),K(v,"click",r[5]),K(D,"click",r[3])],N=!0)},p(S,[A]){A&2&&(d.disabled=S[1]),A&1&&d.value!==S[0]&&ae(d,S[0]),A&4&&$(d,"input-error",S[2]),S[2]?B?B.p(S,A):(B=pt(S),B.c(),B.m(t,b)):B&&(B.d(1),B=null),A&2&&(v.disabled=S[1]),A&2&&M!==(M=S[1]?"Unlocking...":"Unlock")&&J(U,M),A&2&&(D.disabled=S[1]),A&2&&$(D,"loading",S[1])},i:te,o:te,d(S){S&&h(e),B&&B.d(),N=!1,tt(F)}}}function us(r,e,t){let s,l,a,n;we(r,me,p=>t(6,a=p)),we(r,Je,p=>t(7,n=p));const o=Be();let u="",d=!1;async function f(){if(!u){me.setError("Password cannot be empty");return}if(!n.repoUrl){me.setError("GitHub repository not configured. Please check settings.");return}t(1,d=!0),me.clearError();try{const p=await as(u,s);me.unlock(u),st.setArchives(p.archives||[])}catch(p){console.error("Decryption error:",p),me.setError("Incorrect password or corrupted metadata file"),t(0,u="")}finally{t(1,d=!1)}}function b(p){p.key==="Enter"&&f()}function g(){o("openSettings")}function v(){u=this.value,t(0,u)}return r.$$.update=()=>{r.$$.dirty&128&&(s=new rt(n)),r.$$.dirty&64&&t(2,l=a.error)},[u,d,l,f,b,g,a,n,v]}class fs extends ye{constructor(e){super(),Ee(this,e,us,cs,ke,{})}}function bt(r){let e,t,s,l="Archive Password Required",a,n,o="This archive is encrypted. Enter the password to decrypt and view it.",u,d,f,b,g,v,p,w,k,y,I=r[3]?"Decrypting...":"Decrypt",D,M,U,N="<button>close</button>",F,B,S=r[1]?.secret_hint&&vt(r),A=r[4]&&mt(r);return{c(){e=_("dialog"),t=_("div"),s=_("h3"),s.textContent=l,a=T(),n=_("p"),n.textContent=o,u=T(),S&&S.c(),d=T(),f=_("input"),b=T(),A&&A.c(),g=T(),v=_("div"),p=_("button"),w=V("Cancel"),k=T(),y=_("button"),D=V(I),M=T(),U=_("form"),U.innerHTML=N,this.h()},l(L){e=m(L,"DIALOG",{class:!0});var j=E(e);t=m(j,"DIV",{class:!0});var G=E(t);s=m(G,"H3",{class:!0,"data-svelte-h":!0}),z(s)!=="svelte-j0hl0n"&&(s.textContent=l),a=C(G),n=m(G,"P",{class:!0,"data-svelte-h":!0}),z(n)!=="svelte-1iz8eou"&&(n.textContent=o),u=C(G),S&&S.l(G),d=C(G),f=m(G,"INPUT",{type:!0,placeholder:!0,class:!0}),b=C(G),A&&A.l(G),g=C(G),v=m(G,"DIV",{class:!0});var q=E(v);p=m(q,"BUTTON",{class:!0});var x=E(p);w=P(x,"Cancel"),x.forEach(h),k=C(q),y=m(q,"BUTTON",{class:!0});var de=E(y);D=P(de,I),de.forEach(h),q.forEach(h),G.forEach(h),M=C(j),U=m(j,"FORM",{method:!0,class:!0,"data-svelte-h":!0}),z(U)!=="svelte-1eado74"&&(U.innerHTML=N),j.forEach(h),this.h()},h(){c(s,"class","font-bold text-lg mb-2"),c(n,"class","text-sm text-base-content/70 mb-3"),c(f,"type","password"),c(f,"placeholder","Archive password"),c(f,"class","input input-bordered w-full mb-3"),f.disabled=r[3],f.autofocus=!0,$(f,"input-error",r[4]),c(p,"class","btn btn-ghost"),p.disabled=r[3],c(y,"class","btn btn-primary"),y.disabled=r[3],$(y,"loading",r[3]),c(v,"class","modal-action"),c(t,"class","modal-box bg-base-200"),c(U,"method","dialog"),c(U,"class","modal-backdrop"),c(e,"class","modal modal-open")},m(L,j){H(L,e,j),i(e,t),i(t,s),i(t,a),i(t,n),i(t,u),S&&S.m(t,null),i(t,d),i(t,f),ae(f,r[2]),i(t,b),A&&A.m(t,null),i(t,g),i(t,v),i(v,p),i(p,w),i(v,k),i(v,y),i(y,D),i(e,M),i(e,U),f.focus(),F||(B=[K(f,"input",r[8]),K(f,"keypress",r[7]),K(p,"click",r[6]),K(y,"click",r[5]),K(U,"click",r[6])],F=!0)},p(L,j){L[1]?.secret_hint?S?S.p(L,j):(S=vt(L),S.c(),S.m(t,d)):S&&(S.d(1),S=null),j&8&&(f.disabled=L[3]),j&4&&f.value!==L[2]&&ae(f,L[2]),j&16&&$(f,"input-error",L[4]),L[4]?A?A.p(L,j):(A=mt(L),A.c(),A.m(t,g)):A&&(A.d(1),A=null),j&8&&(p.disabled=L[3]),j&8&&I!==(I=L[3]?"Decrypting...":"Decrypt")&&J(D,I),j&8&&(y.disabled=L[3]),j&8&&$(y,"loading",L[3])},d(L){L&&h(e),S&&S.d(),A&&A.d(),F=!1,tt(B)}}}function vt(r){let e,t,s="Password hint:",l,a,n=r[1].secret_hint+"",o;return{c(){e=_("div"),t=_("span"),t.textContent=s,l=T(),a=_("span"),o=V(n),this.h()},l(u){e=m(u,"DIV",{class:!0});var d=E(e);t=m(d,"SPAN",{class:!0,"data-svelte-h":!0}),z(t)!=="svelte-ngl7h5"&&(t.textContent=s),l=C(d),a=m(d,"SPAN",{class:!0});var f=E(a);o=P(f,n),f.forEach(h),d.forEach(h),this.h()},h(){c(t,"class","text-xs text-base-content/50"),c(a,"class","text-sm font-mono ml-2"),c(e,"class","bg-base-300 rounded px-3 py-2 mb-3")},m(u,d){H(u,e,d),i(e,t),i(e,l),i(e,a),i(a,o)},p(u,d){d&2&&n!==(n=u[1].secret_hint+"")&&J(o,n)},d(u){u&&h(e)}}}function mt(r){let e,t,s,l,a,n;return{c(){e=_("div"),t=ge("svg"),s=ge("path"),l=T(),a=_("span"),n=V(r[4]),this.h()},l(o){e=m(o,"DIV",{class:!0});var u=E(e);t=_e(u,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0});var d=E(t);s=_e(d,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),E(s).forEach(h),d.forEach(h),l=C(u),a=m(u,"SPAN",{class:!0});var f=E(a);n=P(f,r[4]),f.forEach(h),u.forEach(h),this.h()},h(){c(s,"stroke-linecap","round"),c(s,"stroke-linejoin","round"),c(s,"stroke-width","2"),c(s,"d","M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"),c(t,"xmlns","http://www.w3.org/2000/svg"),c(t,"class","stroke-current shrink-0 h-6 w-6"),c(t,"fill","none"),c(t,"viewBox","0 0 24 24"),c(a,"class","text-sm"),c(e,"class","alert alert-error mb-3")},m(o,u){H(o,e,u),i(e,t),i(t,s),i(e,l),i(e,a),i(a,n)},p(o,u){u&16&&J(n,o[4])},d(o){o&&h(e)}}}function ds(r){let e,t=r[0]&&bt(r);return{c(){t&&t.c(),e=De()},l(s){t&&t.l(s),e=De()},m(s,l){t&&t.m(s,l),H(s,e,l)},p(s,[l]){s[0]?t?t.p(s,l):(t=bt(s),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:te,o:te,d(s){s&&h(e),t&&t.d(s)}}}function hs(r,e,t){let{archive:s=null}=e,{show:l=!1}=e;const a=Be();let n="",o=!1,u="";async function d(){if(!s||!n){t(4,u="Password cannot be empty");return}t(3,o=!0),t(4,u="");try{if(!await ls(n,s.secret_hint))throw new Error("Password hint mismatch");Ht.add(s.secret_hint,n),a("unlock",{archive:s,password:n}),f()}catch(v){console.error("Archive unlock error:",v),t(4,u="Incorrect password"),t(2,n="")}finally{t(3,o=!1)}}function f(){t(0,l=!1),t(2,n=""),t(4,u="")}function b(v){v.key==="Enter"?d():v.key==="Escape"&&f()}function g(){n=this.value,t(2,n)}return r.$$set=v=>{"archive"in v&&t(1,s=v.archive),"show"in v&&t(0,l=v.show)},[l,s,n,o,u,d,f,b,g]}class ps extends ye{constructor(e){super(),Ee(this,e,hs,ds,ke,{archive:1,show:0})}}function _t(r){let e,t,s,l,a=r[0]?"GitHub Configuration Required":"GitHub Repository Settings",n,o,u,d,f,b,g,v,p='<span class="label-text font-semibold">Repository URL</span>',w,k,y,I,D='<span class="label-text-alt">Format: owner/repo (required)</span>',M,U,N,F='<span class="label-text font-semibold">Branch</span>',B,S,A,L,j='<span class="label-text-alt">Branch containing the archives</span>',G,q,x,de='<span class="label-text font-semibold">Personal Access Token (Optional)</span>',be,O,R,W,ve='<span class="label-text-alt">Required for private repositories. Needs &quot;Contents: Read&quot; permission.</span>',he,se,ee,oe,pe,Se,ie,qe,ce,Ve=r[0]?"Continue":"Save Settings",Fe,je,Ye,lt;function nt(le,Q){return le[0]?vs:bs}let Ge=nt(r),ue=Ge(r);function at(le,Q){return le[3]?_s:ms}let Oe=at(r),fe=Oe(r),Z=r[4]&&gt(r),Y=!r[0]&&wt(r);return{c(){e=_("div"),t=_("div"),s=_("div"),l=_("h2"),n=V(a),o=T(),u=_("p"),ue.c(),d=T(),f=_("div"),b=_("div"),g=_("div"),v=_("label"),v.innerHTML=p,w=T(),k=_("input"),y=T(),I=_("label"),I.innerHTML=D,M=T(),U=_("div"),N=_("label"),N.innerHTML=F,B=T(),S=_("input"),A=T(),L=_("label"),L.innerHTML=j,G=T(),q=_("div"),x=_("label"),x.innerHTML=de,be=T(),O=_("input"),R=T(),W=_("label"),W.innerHTML=ve,he=T(),se=_("div"),ee=_("button"),fe.c(),pe=T(),Z&&Z.c(),Se=T(),ie=_("div"),Y&&Y.c(),qe=T(),ce=_("button"),Fe=V(Ve),this.h()},l(le){e=m(le,"DIV",{class:!0,role:!0,"aria-labelledby":!0,"aria-modal":!0});var Q=E(e);t=m(Q,"DIV",{class:!0,role:!0});var Ce=E(t);s=m(Ce,"DIV",{class:!0});var Re=E(s);l=m(Re,"H2",{id:!0,class:!0});var ot=E(l);n=P(ot,a),ot.forEach(h),o=C(Re),u=m(Re,"P",{class:!0});var it=E(u);ue.l(it),it.forEach(h),Re.forEach(h),d=C(Ce),f=m(Ce,"DIV",{class:!0});var ct=E(f);b=m(ct,"DIV",{class:!0});var ne=E(b);g=m(ne,"DIV",{class:!0});var Te=E(g);v=m(Te,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),z(v)!=="svelte-17dli6s"&&(v.innerHTML=p),w=C(Te),k=m(Te,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),y=C(Te),I=m(Te,"LABEL",{class:!0,"data-svelte-h":!0}),z(I)!=="svelte-k7t3zx"&&(I.innerHTML=D),Te.forEach(h),M=C(ne),U=m(ne,"DIV",{class:!0});var Ue=E(U);N=m(Ue,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),z(N)!=="svelte-139el95"&&(N.innerHTML=F),B=C(Ue),S=m(Ue,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),A=C(Ue),L=m(Ue,"LABEL",{class:!0,"data-svelte-h":!0}),z(L)!=="svelte-1ukeugw"&&(L.innerHTML=j),Ue.forEach(h),G=C(ne),q=m(ne,"DIV",{class:!0});var Le=E(q);x=m(Le,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),z(x)!=="svelte-1gmd0qw"&&(x.innerHTML=de),be=C(Le),O=m(Le,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),R=C(Le),W=m(Le,"LABEL",{class:!0,"data-svelte-h":!0}),z(W)!=="svelte-19turei"&&(W.innerHTML=ve),Le.forEach(h),he=C(ne),se=m(ne,"DIV",{class:!0});var ut=E(se);ee=m(ut,"BUTTON",{class:!0});var ft=E(ee);fe.l(ft),ft.forEach(h),ut.forEach(h),pe=C(ne),Z&&Z.l(ne),ne.forEach(h),ct.forEach(h),Se=C(Ce),ie=m(Ce,"DIV",{class:!0});var ze=E(ie);Y&&Y.l(ze),qe=C(ze),ce=m(ze,"BUTTON",{class:!0});var dt=E(ce);Fe=P(dt,Ve),dt.forEach(h),ze.forEach(h),Ce.forEach(h),Q.forEach(h),this.h()},h(){c(l,"id","settings-title"),c(l,"class","text-2xl font-bold"),c(u,"class","text-sm text-base-content/70 mt-1"),c(s,"class","border-b border-base-300 p-6"),c(v,"class","label"),c(v,"for","repo-url"),c(k,"id","repo-url"),c(k,"type","text"),c(k,"placeholder","owner/repo (e.g., palaima/discord-archives)"),c(k,"class","input input-bordered w-full"),k.required=!0,c(I,"class","label"),c(g,"class","form-control"),c(N,"class","label"),c(N,"for","branch"),c(S,"id","branch"),c(S,"type","text"),c(S,"placeholder","main"),c(S,"class","input input-bordered w-full"),c(L,"class","label"),c(U,"class","form-control"),c(x,"class","label"),c(x,"for","pat"),c(O,"id","pat"),c(O,"type","password"),c(O,"placeholder","github_pat_xxxxx..."),c(O,"class","input input-bordered w-full font-mono text-sm"),c(W,"class","label"),c(q,"class","form-control"),c(ee,"class","btn btn-outline btn-sm"),ee.disabled=oe=r[3]||!r[2].repoUrl,c(se,"class","form-control"),c(b,"class","space-y-4"),c(f,"class","p-6 space-y-6"),c(ce,"class","btn btn-primary"),ce.disabled=je=!r[2].repoUrl,c(ie,"class","border-t border-base-300 p-6 flex justify-end gap-3"),c(t,"class","bg-base-200 rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"),c(t,"role","document"),c(e,"class","fixed inset-0 bg-black bg-opacity-50 z-40 flex items-center justify-center"),c(e,"role","dialog"),c(e,"aria-labelledby","settings-title"),c(e,"aria-modal","true")},m(le,Q){H(le,e,Q),i(e,t),i(t,s),i(s,l),i(l,n),i(s,o),i(s,u),ue.m(u,null),i(t,d),i(t,f),i(f,b),i(b,g),i(g,v),i(g,w),i(g,k),ae(k,r[2].repoUrl),i(g,y),i(g,I),i(b,M),i(b,U),i(U,N),i(U,B),i(U,S),ae(S,r[2].branch),i(U,A),i(U,L),i(b,G),i(b,q),i(q,x),i(q,be),i(q,O),ae(O,r[2].pat),i(q,R),i(q,W),i(b,he),i(b,se),i(se,ee),fe.m(ee,null),i(b,pe),Z&&Z.m(b,null),i(t,Se),i(t,ie),Y&&Y.m(ie,null),i(ie,qe),i(ie,ce),i(ce,Fe),Ye||(lt=[K(k,"input",r[11]),K(S,"input",r[12]),K(O,"input",r[13]),K(ee,"click",r[7]),K(ce,"click",r[5]),K(t,"click",Nt(r[10])),K(t,"keydown",r[8]),K(e,"click",function(){qt(r[0]?void 0:r[6])&&(r[0]?void 0:r[6]).apply(this,arguments)})],Ye=!0)},p(le,Q){r=le,Q&1&&a!==(a=r[0]?"GitHub Configuration Required":"GitHub Repository Settings")&&J(n,a),Ge!==(Ge=nt(r))&&(ue.d(1),ue=Ge(r),ue&&(ue.c(),ue.m(u,null))),Q&4&&k.value!==r[2].repoUrl&&ae(k,r[2].repoUrl),Q&4&&S.value!==r[2].branch&&ae(S,r[2].branch),Q&4&&O.value!==r[2].pat&&ae(O,r[2].pat),Oe!==(Oe=at(r))&&(fe.d(1),fe=Oe(r),fe&&(fe.c(),fe.m(ee,null))),Q&12&&oe!==(oe=r[3]||!r[2].repoUrl)&&(ee.disabled=oe),r[4]?Z?Z.p(r,Q):(Z=gt(r),Z.c(),Z.m(b,null)):Z&&(Z.d(1),Z=null),r[0]?Y&&(Y.d(1),Y=null):Y?Y.p(r,Q):(Y=wt(r),Y.c(),Y.m(ie,qe)),Q&1&&Ve!==(Ve=r[0]?"Continue":"Save Settings")&&J(Fe,Ve),Q&4&&je!==(je=!r[2].repoUrl)&&(ce.disabled=je)},d(le){le&&h(e),ue.d(),fe.d(),Z&&Z.d(),Y&&Y.d(),Ye=!1,tt(lt)}}}function bs(r){let e;return{c(){e=V("Configure the GitHub repository where your encrypted archives are stored")},l(t){e=P(t,"Configure the GitHub repository where your encrypted archives are stored")},m(t,s){H(t,e,s)},d(t){t&&h(e)}}}function vs(r){let e;return{c(){e=V("Configure your GitHub repository to get started. This is required to load archives.")},l(t){e=P(t,"Configure your GitHub repository to get started. This is required to load archives.")},m(t,s){H(t,e,s)},d(t){t&&h(e)}}}function ms(r){let e;return{c(){e=V("Test Connection")},l(t){e=P(t,"Test Connection")},m(t,s){H(t,e,s)},d(t){t&&h(e)}}}function _s(r){let e,t;return{c(){e=_("span"),t=V(`
								Testing...`),this.h()},l(s){e=m(s,"SPAN",{class:!0}),E(e).forEach(h),t=P(s,`
								Testing...`),this.h()},h(){c(e,"class","loading loading-spinner loading-sm")},m(s,l){H(s,e,l),H(s,t,l)},d(s){s&&(h(e),h(t))}}}function gt(r){let e,t,s,l=r[4].success?"Success":"Error",a,n,o,u=r[4].message+"",d;return{c(){e=_("div"),t=_("div"),s=_("span"),a=V(l),n=T(),o=_("p"),d=V(u),this.h()},l(f){e=m(f,"DIV",{class:!0});var b=E(e);t=m(b,"DIV",{});var g=E(t);s=m(g,"SPAN",{class:!0});var v=E(s);a=P(v,l),v.forEach(h),n=C(g),o=m(g,"P",{class:!0});var p=E(o);d=P(p,u),p.forEach(h),g.forEach(h),b.forEach(h),this.h()},h(){c(s,"class","font-semibold"),c(o,"class","text-sm"),c(e,"class","alert"),$(e,"alert-success",r[4].success),$(e,"alert-error",!r[4].success)},m(f,b){H(f,e,b),i(e,t),i(t,s),i(s,a),i(t,n),i(t,o),i(o,d)},p(f,b){b&16&&l!==(l=f[4].success?"Success":"Error")&&J(a,l),b&16&&u!==(u=f[4].message+"")&&J(d,u),b&16&&$(e,"alert-success",f[4].success),b&16&&$(e,"alert-error",!f[4].success)},d(f){f&&h(e)}}}function wt(r){let e,t="Cancel",s,l;return{c(){e=_("button"),e.textContent=t,this.h()},l(a){e=m(a,"BUTTON",{class:!0,"data-svelte-h":!0}),z(e)!=="svelte-121k3bn"&&(e.textContent=t),this.h()},h(){c(e,"class","btn btn-ghost")},m(a,n){H(a,e,n),s||(l=K(e,"click",r[6]),s=!0)},p:te,d(a){a&&h(e),s=!1,l()}}}function gs(r){let e,t=r[1]&&_t(r);return{c(){t&&t.c(),e=De()},l(s){t&&t.l(s),e=De()},m(s,l){t&&t.m(s,l),H(s,e,l)},p(s,[l]){s[1]?t?t.p(s,l):(t=_t(s),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:te,o:te,d(s){s&&h(e),t&&t.d(s)}}}function ws(r,e,t){let s;we(r,Je,M=>t(14,s=M));const l=Be();let{required:a=!1}=e,n=!1,o=s,u=!1,d=null;function f(){t(1,n=!0),t(2,o={...s}),t(4,d=null)}function b(){t(1,n=!1),l("close")}function g(){Je.set(o),b()}function v(){a||(t(2,o={...s}),b())}async function p(){if(!o.repoUrl){t(4,d={success:!1,message:"Please enter a repository URL"});return}t(3,u=!0),t(4,d=null);try{await new rt(o).testConnection()?t(4,d={success:!0,message:"Connection successful! Metadata file found."}):t(4,d={success:!1,message:"Connection failed. Check repository URL and permissions."})}catch(M){t(4,d={success:!1,message:M instanceof Error?M.message:"Unknown error occurred"})}finally{t(3,u=!1)}}function w(M){M.key==="Escape"&&!a&&v()}function k(M){Bt.call(this,r,M)}function y(){o.repoUrl=this.value,t(2,o),t(1,n)}function I(){o.branch=this.value,t(2,o),t(1,n)}function D(){o.pat=this.value,t(2,o),t(1,n)}return r.$$set=M=>{"required"in M&&t(0,a=M.required)},r.$$.update=()=>{r.$$.dirty&6&&n&&!o.repoUrl&&Ae.github.repoUrl&&t(2,o={...o,repoUrl:Ae.github.repoUrl,branch:Ae.github.branch,pat:Ae.github.pat})},[a,n,o,u,d,g,v,p,w,f,k,y,I,D]}class ks extends ye{constructor(e){super(),Ee(this,e,ws,gs,ke,{required:0,open:9})}get open(){return this.$$.ctx[9]}}function ys(r){let e,t,s,l,a="Discord Archives",n,o,u='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>',d,f,b,g,v=r[0].totalArchives+"",p,w,k,y,I,D=r[0].uniqueServers+"",M,U,N,F,B,S=r[0].uniqueChannels+"",A,L,j,G,q,x,de;const be=r[3].default,O=Ft(be,r,r[2],null);return{c(){e=_("div"),t=_("div"),s=_("div"),l=_("h1"),l.textContent=a,n=T(),o=_("button"),o.innerHTML=u,d=T(),f=_("div"),b=_("div"),g=V("ðŸ“ "),p=V(v),w=V(" archives"),k=T(),y=_("div"),I=V("ðŸ–¥ï¸ "),M=V(D),U=V(" servers"),N=T(),F=_("div"),B=V("ðŸ’¬ "),A=V(S),L=V(" channels"),j=T(),G=_("div"),O&&O.c(),this.h()},l(R){e=m(R,"DIV",{class:!0});var W=E(e);t=m(W,"DIV",{class:!0});var ve=E(t);s=m(ve,"DIV",{class:!0});var he=E(s);l=m(he,"H1",{class:!0,"data-svelte-h":!0}),z(l)!=="svelte-176jj07"&&(l.textContent=a),n=C(he),o=m(he,"BUTTON",{class:!0,title:!0,"aria-label":!0,"data-svelte-h":!0}),z(o)!=="svelte-9qjold"&&(o.innerHTML=u),he.forEach(h),d=C(ve),f=m(ve,"DIV",{class:!0});var se=E(f);b=m(se,"DIV",{});var ee=E(b);g=P(ee,"ðŸ“ "),p=P(ee,v),w=P(ee," archives"),ee.forEach(h),k=C(se),y=m(se,"DIV",{});var oe=E(y);I=P(oe,"ðŸ–¥ï¸ "),M=P(oe,D),U=P(oe," servers"),oe.forEach(h),N=C(se),F=m(se,"DIV",{});var pe=E(F);B=P(pe,"ðŸ’¬ "),A=P(pe,S),L=P(pe," channels"),pe.forEach(h),se.forEach(h),ve.forEach(h),j=C(W),G=m(W,"DIV",{class:!0});var Se=E(G);O&&O.l(Se),Se.forEach(h),W.forEach(h),this.h()},h(){c(l,"class","text-xl font-semibold"),c(o,"class","btn btn-ghost btn-sm btn-square"),c(o,"title","Settings"),c(o,"aria-label","Open settings"),c(s,"class","flex items-center justify-between mb-3"),c(f,"class","text-sm space-y-1 text-base-content/70"),c(t,"class","p-5 bg-base-300 border-b border-base-100"),c(G,"class","flex-1 overflow-y-auto p-3"),c(e,"class","w-80 bg-base-200 border-r border-base-300 flex flex-col h-screen")},m(R,W){H(R,e,W),i(e,t),i(t,s),i(s,l),i(s,n),i(s,o),i(t,d),i(t,f),i(f,b),i(b,g),i(b,p),i(b,w),i(f,k),i(f,y),i(y,I),i(y,M),i(y,U),i(f,N),i(f,F),i(F,B),i(F,A),i(F,L),i(e,j),i(e,G),O&&O.m(G,null),q=!0,x||(de=K(o,"click",r[1]),x=!0)},p(R,[W]){(!q||W&1)&&v!==(v=R[0].totalArchives+"")&&J(p,v),(!q||W&1)&&D!==(D=R[0].uniqueServers+"")&&J(M,D),(!q||W&1)&&S!==(S=R[0].uniqueChannels+"")&&J(A,S),O&&O.p&&(!q||W&4)&&jt(O,be,R,R[2],q?Ot(be,R[2],W,null):Gt(R[2]),null)},i(R){q||(X(O,R),q=!0)},o(R){re(O,R),q=!1},d(R){R&&h(e),O&&O.d(R),x=!1,de()}}}function Es(r,e,t){let s;we(r,Xt,u=>t(0,s=u));let{$$slots:l={},$$scope:a}=e;const n=Be();function o(){n("openSettings")}return r.$$set=u=>{"$$scope"in u&&t(2,a=u.$$scope)},[s,o,a,l]}class Ss extends ye{constructor(e){super(),Ee(this,e,Es,ys,ke,{})}}function kt(r,e,t){const s=r.slice();return s[6]=e[t],s}function yt(r){let e,t=xe(r[1].channels),s=[];for(let l=0;l<t.length;l+=1)s[l]=Et(kt(r,t,l));return{c(){e=_("div");for(let l=0;l<s.length;l+=1)s[l].c();this.h()},l(l){e=m(l,"DIV",{class:!0});var a=E(e);for(let n=0;n<s.length;n+=1)s[n].l(a);a.forEach(h),this.h()},h(){c(e,"class","pl-3 mt-2 space-y-1")},m(l,a){H(l,e,a);for(let n=0;n<s.length;n+=1)s[n]&&s[n].m(e,null)},p(l,a){if(a&10){t=xe(l[1].channels);let n;for(n=0;n<t.length;n+=1){const o=kt(l,t,n);s[n]?s[n].p(o,a):(s[n]=Et(o),s[n].c(),s[n].m(e,null))}for(;n<s.length;n+=1)s[n].d(1);s.length=t.length}},d(l){l&&h(e),At(s,l)}}}function Et(r){let e,t,s="#",l,a,n=(r[6].channel_name||r[6].channel_id)+"",o,u,d,f=new Date(r[6].exported_at).toLocaleDateString()+"",b,g,v,p;function w(){return r[4](r[6])}return{c(){e=_("button"),t=_("span"),t.textContent=s,l=T(),a=_("span"),o=V(n),u=T(),d=_("span"),b=V(f),g=T(),this.h()},l(k){e=m(k,"BUTTON",{class:!0});var y=E(e);t=m(y,"SPAN",{class:!0,"data-svelte-h":!0}),z(t)!=="svelte-ulfyf0"&&(t.textContent=s),l=C(y),a=m(y,"SPAN",{class:!0});var I=E(a);o=P(I,n),I.forEach(h),u=C(y),d=m(y,"SPAN",{class:!0});var D=E(d);b=P(D,f),D.forEach(h),g=C(y),y.forEach(h),this.h()},h(){c(t,"class","text-base-content/50 group-hover:text-base-content"),c(a,"class","flex-1"),c(d,"class","text-xs text-base-content/40"),c(e,"class","w-full px-3 py-2 rounded hover:bg-base-100 transition-colors flex items-center gap-2 text-sm text-left group")},m(k,y){H(k,e,y),i(e,t),i(e,l),i(e,a),i(a,o),i(e,u),i(e,d),i(d,b),i(e,g),v||(p=K(e,"click",w),v=!0)},p(k,y){r=k,y&2&&n!==(n=(r[6].channel_name||r[6].channel_id)+"")&&J(o,n),y&2&&f!==(f=new Date(r[6].exported_at).toLocaleDateString()+"")&&J(b,f)},d(k){k&&h(e),v=!1,p()}}}function Cs(r){let e,t,s,l="â–¼",a,n,o=r[1].name+"",u,d,f,b,g=!r[0]&&yt(r);return{c(){e=_("div"),t=_("button"),s=_("span"),s.textContent=l,a=T(),n=_("span"),u=V(o),d=T(),g&&g.c(),this.h()},l(v){e=m(v,"DIV",{class:!0});var p=E(e);t=m(p,"BUTTON",{class:!0});var w=E(t);s=m(w,"SPAN",{class:!0,"data-svelte-h":!0}),z(s)!=="svelte-12dk04l"&&(s.textContent=l),a=C(w),n=m(w,"SPAN",{});var k=E(n);u=P(k,o),k.forEach(h),w.forEach(h),d=C(p),g&&g.l(p),p.forEach(h),this.h()},h(){c(s,"class","transform transition-transform text-xs"),$(s,"rotate-0",!r[0]),$(s,"-rotate-90",r[0]),c(t,"class","w-full px-3 py-2 bg-base-300 rounded hover:bg-base-100 transition-colors flex items-center gap-2 font-semibold text-sm"),c(e,"class","mb-4")},m(v,p){H(v,e,p),i(e,t),i(t,s),i(t,a),i(t,n),i(n,u),i(e,d),g&&g.m(e,null),f||(b=K(t,"click",r[2]),f=!0)},p(v,[p]){p&1&&$(s,"rotate-0",!v[0]),p&1&&$(s,"-rotate-90",v[0]),p&2&&o!==(o=v[1].name+"")&&J(u,o),v[0]?g&&(g.d(1),g=null):g?g.p(v,p):(g=yt(v),g.c(),g.m(e,null))},i:te,o:te,d(v){v&&h(e),g&&g.d(),f=!1,b()}}}function Ts(r,e,t){let{server:s}=e,{collapsed:l=!1}=e;const a=Be();function n(){t(0,l=!l)}function o(d){a("selectChannel",d)}const u=d=>o(d);return r.$$set=d=>{"server"in d&&t(1,s=d.server),"collapsed"in d&&t(0,l=d.collapsed)},[l,s,n,o,u]}class Us extends ye{constructor(e){super(),Ee(this,e,Ts,Cs,ke,{server:1,collapsed:0})}}function Ls(r){let e,t="Welcome",s,l,a="Select a channel to view";return{c(){e=_("h2"),e.textContent=t,s=T(),l=_("div"),l.textContent=a,this.h()},l(n){e=m(n,"H2",{class:!0,"data-svelte-h":!0}),z(e)!=="svelte-qeexzb"&&(e.textContent=t),s=C(n),l=m(n,"DIV",{class:!0,"data-svelte-h":!0}),z(l)!=="svelte-563yit"&&(l.textContent=a),this.h()},h(){c(e,"class","text-lg font-semibold"),c(l,"class","text-sm text-base-content/60")},m(n,o){H(n,e,o),H(n,s,o),H(n,l,o)},p:te,d(n){n&&(h(e),h(s),h(l))}}}function As(r){let e,t,s=(r[0].channel_name||r[0].channel_id)+"",l,a,n=r[0].export_path.endsWith(".enc"),o,u,d,f=new Date(r[0].exported_at).toLocaleString()+"",b,g,v=r[0].format.toUpperCase()+"",p,w=n&&St();return{c(){e=_("div"),t=_("h2"),l=V(s),a=T(),w&&w.c(),o=T(),u=_("div"),d=V("Latest export: "),b=V(f),g=V(" â€¢ "),p=V(v),this.h()},l(k){e=m(k,"DIV",{class:!0});var y=E(e);t=m(y,"H2",{class:!0});var I=E(t);l=P(I,s),a=C(I),w&&w.l(I),I.forEach(h),y.forEach(h),o=C(k),u=m(k,"DIV",{class:!0});var D=E(u);d=P(D,"Latest export: "),b=P(D,f),g=P(D," â€¢ "),p=P(D,v),D.forEach(h),this.h()},h(){c(t,"class","text-lg font-semibold"),c(e,"class","flex items-center gap-2"),c(u,"class","text-sm text-base-content/60 mt-1")},m(k,y){H(k,e,y),i(e,t),i(t,l),i(t,a),w&&w.m(t,null),H(k,o,y),H(k,u,y),i(u,d),i(u,b),i(u,g),i(u,p)},p(k,y){y&1&&s!==(s=(k[0].channel_name||k[0].channel_id)+"")&&J(l,s),y&1&&(n=k[0].export_path.endsWith(".enc")),n?w||(w=St(),w.c(),w.m(t,null)):w&&(w.d(1),w=null),y&1&&f!==(f=new Date(k[0].exported_at).toLocaleString()+"")&&J(b,f),y&1&&v!==(v=k[0].format.toUpperCase()+"")&&J(p,v)},d(k){k&&(h(e),h(o),h(u)),w&&w.d()}}}function St(r){let e,t="ðŸ”’";return{c(){e=_("span"),e.textContent=t,this.h()},l(s){e=m(s,"SPAN",{class:!0,"data-svelte-h":!0}),z(e)!=="svelte-1cny2mi"&&(e.textContent=t),this.h()},h(){c(e,"class","ml-2")},m(s,l){H(s,e,l)},d(s){s&&h(e)}}}function Ds(r){let e,t='<div class="text-6xl mb-4">ðŸ“–</div> <div class="text-lg">Select a channel from the sidebar to start browsing</div>';return{c(){e=_("div"),e.innerHTML=t,this.h()},l(s){e=m(s,"DIV",{class:!0,"data-svelte-h":!0}),z(e)!=="svelte-54z0r5"&&(e.innerHTML=t),this.h()},h(){c(e,"class","flex flex-col items-center justify-center h-full text-base-content/40")},m(s,l){H(s,e,l)},p:te,d(s){s&&h(e)}}}function Is(r){let e,t;return{c(){e=_("iframe"),this.h()},l(s){e=m(s,"IFRAME",{src:!0,title:!0,class:!0}),E(e).forEach(h),this.h()},h(){ht(e.src,t=r[1])||c(e,"src",t),c(e,"title","Archive viewer"),c(e,"class","w-full h-full border-0")},m(s,l){H(s,e,l)},p(s,l){l&2&&!ht(e.src,t=s[1])&&c(e,"src",t)},d(s){s&&h(e)}}}function Hs(r){let e,t='<div class="loading loading-spinner loading-lg"></div>';return{c(){e=_("div"),e.innerHTML=t,this.h()},l(s){e=m(s,"DIV",{class:!0,"data-svelte-h":!0}),z(e)!=="svelte-1nt18fs"&&(e.innerHTML=t),this.h()},h(){c(e,"class","flex items-center justify-center h-full")},m(s,l){H(s,e,l)},p:te,d(s){s&&h(e)}}}function Ms(r){let e,t,s,l;function a(b,g){return b[0]?As:Ls}let n=a(r),o=n(r);function u(b,g){return b[2]?Hs:b[1]?Is:Ds}let d=u(r),f=d(r);return{c(){e=_("div"),t=_("div"),o.c(),s=T(),l=_("div"),f.c(),this.h()},l(b){e=m(b,"DIV",{class:!0});var g=E(e);t=m(g,"DIV",{class:!0});var v=E(t);o.l(v),v.forEach(h),s=C(g),l=m(g,"DIV",{class:!0});var p=E(l);f.l(p),p.forEach(h),g.forEach(h),this.h()},h(){c(t,"class","p-4 bg-base-200 border-b border-base-300"),c(l,"class","flex-1 overflow-hidden"),c(e,"class","flex-1 flex flex-col bg-base-100")},m(b,g){H(b,e,g),i(e,t),o.m(t,null),i(e,s),i(e,l),f.m(l,null)},p(b,[g]){n===(n=a(b))&&o?o.p(b,g):(o.d(1),o=n(b),o&&(o.c(),o.m(t,null))),d===(d=u(b))&&f?f.p(b,g):(f.d(1),f=d(b),f&&(f.c(),f.m(l,null)))},i:te,o:te,d(b){b&&h(e),o.d(),f.d()}}}function Ps(r,e,t){let{archive:s=null}=e,{blobUrl:l=null}=e,{isLoading:a=!1}=e;return r.$$set=n=>{"archive"in n&&t(0,s=n.archive),"blobUrl"in n&&t(1,l=n.blobUrl),"isLoading"in n&&t(2,a=n.isLoading)},[s,l,a]}class Vs extends ye{constructor(e){super(),Ee(this,e,Ps,Ms,ke,{archive:0,blobUrl:1,isLoading:2})}}function Ct(r,e,t){const s=r.slice();return s[18]=e[t],s}function Tt(r){let e,t;return e=new fs({}),e.$on("openSettings",r[11]),{c(){Pe(e.$$.fragment)},l(s){Me(e.$$.fragment,s)},m(s,l){He(e,s,l),t=!0},p:te,i(s){t||(X(e.$$.fragment,s),t=!0)},o(s){re(e.$$.fragment,s),t=!1},d(s){Ie(e,s)}}}function Ut(r){let e,t,s,l;return e=new Ss({props:{$$slots:{default:[Ns]},$$scope:{ctx:r}}}),e.$on("openSettings",r[11]),s=new Vs({props:{archive:r[3],blobUrl:r[4],isLoading:r[5]}}),{c(){Pe(e.$$.fragment),t=T(),Pe(s.$$.fragment)},l(a){Me(e.$$.fragment,a),t=C(a),Me(s.$$.fragment,a)},m(a,n){He(e,a,n),H(a,t,n),He(s,a,n),l=!0},p(a,n){const o={};n&2097408&&(o.$$scope={dirty:n,ctx:a}),e.$set(o);const u={};n&8&&(u.archive=a[3]),n&16&&(u.blobUrl=a[4]),n&32&&(u.isLoading=a[5]),s.$set(u)},i(a){l||(X(e.$$.fragment,a),X(s.$$.fragment,a),l=!0)},o(a){re(e.$$.fragment,a),re(s.$$.fragment,a),l=!1},d(a){a&&h(t),Ie(e,a),Ie(s,a)}}}function Lt(r){let e,t;return e=new Us({props:{server:r[18]}}),e.$on("selectChannel",r[9]),{c(){Pe(e.$$.fragment)},l(s){Me(e.$$.fragment,s)},m(s,l){He(e,s,l),t=!0},p(s,l){const a={};l&256&&(a.server=s[18]),e.$set(a)},i(s){t||(X(e.$$.fragment,s),t=!0)},o(s){re(e.$$.fragment,s),t=!1},d(s){Ie(e,s)}}}function Ns(r){let e,t,s=xe(r[8]),l=[];for(let n=0;n<s.length;n+=1)l[n]=Lt(Ct(r,s,n));const a=n=>re(l[n],1,1,()=>{l[n]=null});return{c(){for(let n=0;n<l.length;n+=1)l[n].c();e=De()},l(n){for(let o=0;o<l.length;o+=1)l[o].l(n);e=De()},m(n,o){for(let u=0;u<l.length;u+=1)l[u]&&l[u].m(n,o);H(n,e,o),t=!0},p(n,o){if(o&768){s=xe(n[8]);let u;for(u=0;u<s.length;u+=1){const d=Ct(n,s,u);l[u]?(l[u].p(d,o),X(l[u],1)):(l[u]=Lt(d),l[u].c(),X(l[u],1),l[u].m(e.parentNode,e))}for($e(),u=s.length;u<l.length;u+=1)a(u);Xe()}},i(n){if(!t){for(let o=0;o<s.length;o+=1)X(l[o]);t=!0}},o(n){l=l.filter(Boolean);for(let o=0;o<l.length;o+=1)re(l[o]);t=!1},d(n){n&&h(e),At(l,n)}}}function Bs(r){let e,t,s,l,a,n,o,u,d,f=!r[2].isUnlocked&&r[1]&&Tt(r);function b(w){r[14](w)}let g={archive:r[7]};r[6]!==void 0&&(g.show=r[6]),l=new ps({props:g}),Dt.push(()=>Kt(l,"show",b)),l.$on("unlock",r[10]);let v={required:!r[1]&&!r[2].isUnlocked};o=new ks({props:v}),r[15](o);let p=r[2].isUnlocked&&Ut(r);return{c(){e=T(),t=_("div"),f&&f.c(),s=T(),Pe(l.$$.fragment),n=T(),Pe(o.$$.fragment),u=T(),p&&p.c(),this.h()},l(w){zt("svelte-1v5xc6b",document.head).forEach(h),e=C(w),t=m(w,"DIV",{class:!0});var y=E(t);f&&f.l(y),s=C(y),Me(l.$$.fragment,y),n=C(y),Me(o.$$.fragment,y),u=C(y),p&&p.l(y),y.forEach(h),this.h()},h(){document.title="Discord Archive Browser",c(t,"class","flex h-screen overflow-hidden")},m(w,k){H(w,e,k),H(w,t,k),f&&f.m(t,null),i(t,s),He(l,t,null),i(t,n),He(o,t,null),i(t,u),p&&p.m(t,null),d=!0},p(w,[k]){!w[2].isUnlocked&&w[1]?f?(f.p(w,k),k&6&&X(f,1)):(f=Tt(w),f.c(),X(f,1),f.m(t,s)):f&&($e(),re(f,1,1,()=>{f=null}),Xe());const y={};k&128&&(y.archive=w[7]),!a&&k&64&&(a=!0,y.show=w[6],Rt(()=>a=!1)),l.$set(y);const I={};k&6&&(I.required=!w[1]&&!w[2].isUnlocked),o.$set(I),w[2].isUnlocked?p?(p.p(w,k),k&4&&X(p,1)):(p=Ut(w),p.c(),X(p,1),p.m(t,null)):p&&($e(),re(p,1,1,()=>{p=null}),Xe())},i(w){d||(X(f),X(l.$$.fragment,w),X(o.$$.fragment,w),X(p),d=!0)},o(w){re(f),re(l.$$.fragment,w),re(o.$$.fragment,w),re(p),d=!1},d(w){w&&(h(e),h(t)),f&&f.d(),Ie(l),r[15](null),Ie(o),p&&p.d()}}}function qs(r,e,t){let s,l,a,n,o;we(r,Je,U=>t(13,a=U)),we(r,me,U=>t(2,n=U)),we(r,Qt,U=>t(8,o=U));let u=null,d=null,f=!1,b=!1,g=null,v,p=!1;async function w(U){const N=U.detail;if(t(3,u=N),N.export_path.endsWith(".enc")){const F=Ht.get(N.secret_hint);F?await y(N,F):(t(7,g=N),t(6,b=!0))}else t(4,d=N.export_path)}async function k(U){const{archive:N,password:F}=U.detail;await y(N,F),t(6,b=!1)}async function y(U,N){t(5,f=!0);try{const F=await os(U.export_path,N,l);d&&d.startsWith("blob:")&&URL.revokeObjectURL(d),t(4,d=is(F,U))}catch(F){console.error("Failed to load encrypted archive:",F);const B=F instanceof Error?F.message:"The file may be corrupted.";alert(`Failed to decrypt and load archive: ${B}`)}finally{t(5,f=!1)}}function I(){v.open()}function D(U){b=U,t(6,b)}function M(U){Dt[U?"unshift":"push"](()=>{v=U,t(0,v)})}return r.$$.update=()=>{r.$$.dirty&8192&&t(1,s=!!a.repoUrl),r.$$.dirty&4103&&!s&&!n.isUnlocked&&!p&&(t(12,p=!0),setTimeout(()=>v?.open(),100)),r.$$.dirty&8192&&(l=new rt(a))},[v,s,n,u,d,f,b,g,o,w,k,I,p,a,D,M]}class zs extends ye{constructor(e){super(),Ee(this,e,qs,Bs,ke,{})}}export{zs as component,Rs as universal};
