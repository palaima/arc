import{s as Y,n as F,d as _,r as Me,P as ce,Q as R,e as q,f as T,h as c,R as G,A as p,j as b,k as y,S as O,m as S,l as N,o as g,p as U,t as x,q as fe,T as ue,U as de,v as he,V as Ne,c as qe,u as Oe,g as ze,b as Re,W as xe,X as ke,C as Fe,Y as Ke,Z as We}from"../chunks/Ba48d7px.js";import{S as $,i as ee,t as z,a as H,f as Ge,d as se,c as _e,m as le,e as re,b as ne,g as me}from"../chunks/CDv9raoO.js";import{w as be,d as Be}from"../chunks/B5KRQfIH.js";function pe(n){return n?.length!==void 0?n:Array.from(n)}const Ze=!0,Je=!1,Nt=Object.freeze(Object.defineProperty({__proto__:null,prerender:Ze,ssr:Je},Symbol.toStringTag,{value:"Module"}));function Qe(){const{subscribe:n,set:e,update:t}=be({isUnlocked:!1,masterPassword:null,error:null});return{subscribe:n,unlock:s=>{t(l=>({...l,isUnlocked:!0,masterPassword:s,error:null}))},setError:s=>{t(l=>({...l,error:s}))},clearError:()=>{t(s=>({...s,error:null}))},reset:()=>{e({isUnlocked:!1,masterPassword:null,error:null})}}}const X=Qe();function Xe(){const{subscribe:n,set:e,update:t}=be(new Map);return{subscribe:n,add:(s,l)=>{t(a=>{const r=new Map(a);return r.set(s,l),r})},get:s=>{let l;return n(a=>{l=a.get(s)})(),l},has:s=>{let l=!1;return n(a=>{l=a.has(s)})(),l},clear:()=>{e(new Map)}}}const je=Xe();function Ye(){const{subscribe:n,set:e,update:t}=be({archives:[],isLoading:!1,error:null});return{subscribe:n,setArchives:s=>{e({archives:s,isLoading:!1,error:null})},setLoading:s=>{t(l=>({...l,isLoading:s}))},setError:s=>{t(l=>({...l,error:s,isLoading:!1}))},reset:()=>{e({archives:[],isLoading:!1,error:null})}}}const ge=Ye(),$e=Be(ge,n=>{if(!n.archives.length)return[];const e=new Map,t=new Map;return n.archives.forEach(s=>{const l=`${s.server_id}-${s.channel_id}`;t.has(l)||t.set(l,[]),t.get(l).push(s)}),t.forEach((s,l)=>{s.sort((i,o)=>new Date(o.exported_at).getTime()-new Date(i.exported_at).getTime());const a=s[0];e.has(a.server_id)||e.set(a.server_id,{id:a.server_id,name:a.server_name,channels:[]});const r={...a,versions:s,versionCount:s.length};e.get(a.server_id).channels.push(r)}),Array.from(e.values())}),et=Be(ge,n=>{const e=new Set(n.archives.map(s=>s.server_id)),t=new Set(n.archives.map(s=>s.channel_id));return{totalArchives:n.archives.length,uniqueServers:e.size,uniqueChannels:t.size}}),tt=6e5;async function st(n,e){const t=new TextEncoder,s=await crypto.subtle.importKey("raw",t.encode(n),"PBKDF2",!1,["deriveBits"]),l=await crypto.subtle.deriveBits({name:"PBKDF2",salt:e,iterations:tt,hash:"SHA-256"},s,256);return await crypto.subtle.importKey("raw",l,"AES-GCM",!1,["decrypt"])}async function lt(n){const t=new TextEncoder().encode(n),s=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(s)).map(r=>r.toString(16).padStart(2,"0")).join("").substring(0,8)}async function rt(n,e){return await lt(n)===e}const te=8,ve=12;async function He(n,e){if(n.length<te+ve)throw new Error("Invalid encrypted data: too short");const t=n.slice(0,te),s=n.slice(te,te+ve),l=n.slice(te+ve),a=await st(e,t),r=await crypto.subtle.decrypt({name:"AES-GCM",iv:s},a,l);return new Uint8Array(r)}async function nt(n,e){const t=await He(n,e),l=new TextDecoder().decode(t);return JSON.parse(l)}async function at(n){let e;if(e=await fetch("../.archive_metadata.json.enc"),e.ok||(e=await fetch(".archive_metadata.json.enc")),!e.ok)throw new Error("Failed to load metadata file");const t=new Uint8Array(await e.arrayBuffer());return await nt(t,n)}async function ot(n,e){let t=n;t.startsWith("archives/")&&(t=t.substring(9));const s=await fetch(t);if(!s.ok)throw new Error(`Failed to load archive file: ${t} (${s.status})`);const l=new Uint8Array(await s.arrayBuffer());return await He(l,e)}function it(n,e){const t=e.format==="html"||e.format.startsWith("html")?"text/html":e.format==="json"?"application/json":"text/plain",s=new Blob([n],{type:t});return URL.createObjectURL(s)}function Ee(n){let e,t,s,l,a,r;return{c(){e=g("div"),t=de("svg"),s=de("path"),l=U(),a=g("span"),r=x(n[2]),this.h()},l(i){e=b(i,"DIV",{class:!0});var o=y(e);t=ue(o,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0});var f=y(t);s=ue(f,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),y(s).forEach(_),f.forEach(_),l=S(o),a=b(o,"SPAN",{class:!0});var u=y(a);r=N(u,n[2]),u.forEach(_),o.forEach(_),this.h()},h(){p(s,"stroke-linecap","round"),p(s,"stroke-linejoin","round"),p(s,"stroke-width","2"),p(s,"d","M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"),p(t,"xmlns","http://www.w3.org/2000/svg"),p(t,"class","stroke-current shrink-0 h-6 w-6"),p(t,"fill","none"),p(t,"viewBox","0 0 24 24"),p(a,"class","text-sm"),p(e,"class","alert alert-error mb-3")},m(i,o){T(i,e,o),c(e,t),c(t,s),c(e,l),c(e,a),c(a,r)},p(i,o){o&4&&q(r,i[2])},d(i){i&&_(e)}}}function ct(n){let e,t,s,l="Master Password Required",a,r,i="Enter your master password to decrypt the archive metadata and browse your archives.",o,f,u,v,d,h,m=n[1]?"Unlocking...":"Unlock",w,k,E,A=n[2]&&Ee(n);return{c(){e=g("dialog"),t=g("div"),s=g("h3"),s.textContent=l,a=U(),r=g("p"),r.textContent=i,o=U(),f=g("input"),u=U(),A&&A.c(),v=U(),d=g("div"),h=g("button"),w=x(m),this.h()},l(C){e=b(C,"DIALOG",{class:!0});var B=y(e);t=b(B,"DIV",{class:!0});var P=y(t);s=b(P,"H3",{class:!0,"data-svelte-h":!0}),O(s)!=="svelte-12v7ilt"&&(s.textContent=l),a=S(P),r=b(P,"P",{class:!0,"data-svelte-h":!0}),O(r)!=="svelte-1nzkc2t"&&(r.textContent=i),o=S(P),f=b(P,"INPUT",{type:!0,placeholder:!0,class:!0}),u=S(P),A&&A.l(P),v=S(P),d=b(P,"DIV",{class:!0});var K=y(d);h=b(K,"BUTTON",{class:!0});var W=y(h);w=N(W,m),W.forEach(_),K.forEach(_),P.forEach(_),B.forEach(_),this.h()},h(){p(s,"class","font-bold text-lg mb-2"),p(r,"class","text-sm text-base-content/70 mb-4"),p(f,"type","password"),p(f,"placeholder","Master password"),p(f,"class","input input-bordered w-full mb-3"),f.disabled=n[1],f.autofocus=!0,R(f,"input-error",n[2]),p(h,"class","btn btn-primary"),h.disabled=n[1],R(h,"loading",n[1]),p(d,"class","modal-action"),p(t,"class","modal-box bg-base-200"),p(e,"class","modal modal-open")},m(C,B){T(C,e,B),c(e,t),c(t,s),c(t,a),c(t,r),c(t,o),c(t,f),ce(f,n[0]),c(t,u),A&&A.m(t,null),c(t,v),c(t,d),c(d,h),c(h,w),f.focus(),k||(E=[G(f,"input",n[6]),G(f,"keypress",n[4]),G(h,"click",n[3])],k=!0)},p(C,[B]){B&2&&(f.disabled=C[1]),B&1&&f.value!==C[0]&&ce(f,C[0]),B&4&&R(f,"input-error",C[2]),C[2]?A?A.p(C,B):(A=Ee(C),A.c(),A.m(t,v)):A&&(A.d(1),A=null),B&2&&m!==(m=C[1]?"Unlocking...":"Unlock")&&q(w,m),B&2&&(h.disabled=C[1]),B&2&&R(h,"loading",C[1])},i:F,o:F,d(C){C&&_(e),A&&A.d(),k=!1,Me(E)}}}function ft(n,e,t){let s,l;fe(n,X,u=>t(5,l=u));let a="",r=!1;async function i(){if(!a){X.setError("Password cannot be empty");return}t(1,r=!0),X.clearError();try{const u=await at(a);X.unlock(a),ge.setArchives(u.archives||[])}catch(u){console.error("Decryption error:",u),X.setError("Incorrect password or corrupted metadata file"),t(0,a="")}finally{t(1,r=!1)}}function o(u){u.key==="Enter"&&i()}function f(){a=this.value,t(0,a)}return n.$$.update=()=>{n.$$.dirty&32&&t(2,s=l.error)},[a,r,s,i,o,l,f]}class ut extends ${constructor(e){super(),ee(this,e,ft,ct,Y,{})}}function ye(n){let e,t,s,l="Archive Password Required",a,r,i="This archive is encrypted. Enter the password to decrypt and view it.",o,f,u,v,d,h,m,w,k,E,A=n[3]?"Decrypting...":"Decrypt",C,B,P,K="<button>close</button>",W,Q,M=n[1]?.secret_hint&&Ce(n),L=n[4]&&Ae(n);return{c(){e=g("dialog"),t=g("div"),s=g("h3"),s.textContent=l,a=U(),r=g("p"),r.textContent=i,o=U(),M&&M.c(),f=U(),u=g("input"),v=U(),L&&L.c(),d=U(),h=g("div"),m=g("button"),w=x("Cancel"),k=U(),E=g("button"),C=x(A),B=U(),P=g("form"),P.innerHTML=K,this.h()},l(V){e=b(V,"DIALOG",{class:!0});var I=y(e);t=b(I,"DIV",{class:!0});var D=y(t);s=b(D,"H3",{class:!0,"data-svelte-h":!0}),O(s)!=="svelte-j0hl0n"&&(s.textContent=l),a=S(D),r=b(D,"P",{class:!0,"data-svelte-h":!0}),O(r)!=="svelte-1iz8eou"&&(r.textContent=i),o=S(D),M&&M.l(D),f=S(D),u=b(D,"INPUT",{type:!0,placeholder:!0,class:!0}),v=S(D),L&&L.l(D),d=S(D),h=b(D,"DIV",{class:!0});var j=y(h);m=b(j,"BUTTON",{class:!0});var J=y(m);w=N(J,"Cancel"),J.forEach(_),k=S(j),E=b(j,"BUTTON",{class:!0});var Z=y(E);C=N(Z,A),Z.forEach(_),j.forEach(_),D.forEach(_),B=S(I),P=b(I,"FORM",{method:!0,class:!0,"data-svelte-h":!0}),O(P)!=="svelte-1eado74"&&(P.innerHTML=K),I.forEach(_),this.h()},h(){p(s,"class","font-bold text-lg mb-2"),p(r,"class","text-sm text-base-content/70 mb-3"),p(u,"type","password"),p(u,"placeholder","Archive password"),p(u,"class","input input-bordered w-full mb-3"),u.disabled=n[3],u.autofocus=!0,R(u,"input-error",n[4]),p(m,"class","btn btn-ghost"),m.disabled=n[3],p(E,"class","btn btn-primary"),E.disabled=n[3],R(E,"loading",n[3]),p(h,"class","modal-action"),p(t,"class","modal-box bg-base-200"),p(P,"method","dialog"),p(P,"class","modal-backdrop"),p(e,"class","modal modal-open")},m(V,I){T(V,e,I),c(e,t),c(t,s),c(t,a),c(t,r),c(t,o),M&&M.m(t,null),c(t,f),c(t,u),ce(u,n[2]),c(t,v),L&&L.m(t,null),c(t,d),c(t,h),c(h,m),c(m,w),c(h,k),c(h,E),c(E,C),c(e,B),c(e,P),u.focus(),W||(Q=[G(u,"input",n[8]),G(u,"keypress",n[7]),G(m,"click",n[6]),G(E,"click",n[5]),G(P,"click",n[6])],W=!0)},p(V,I){V[1]?.secret_hint?M?M.p(V,I):(M=Ce(V),M.c(),M.m(t,f)):M&&(M.d(1),M=null),I&8&&(u.disabled=V[3]),I&4&&u.value!==V[2]&&ce(u,V[2]),I&16&&R(u,"input-error",V[4]),V[4]?L?L.p(V,I):(L=Ae(V),L.c(),L.m(t,d)):L&&(L.d(1),L=null),I&8&&(m.disabled=V[3]),I&8&&A!==(A=V[3]?"Decrypting...":"Decrypt")&&q(C,A),I&8&&(E.disabled=V[3]),I&8&&R(E,"loading",V[3])},d(V){V&&_(e),M&&M.d(),L&&L.d(),W=!1,Me(Q)}}}function Ce(n){let e,t,s="Password hint:",l,a,r=n[1].secret_hint+"",i;return{c(){e=g("div"),t=g("span"),t.textContent=s,l=U(),a=g("span"),i=x(r),this.h()},l(o){e=b(o,"DIV",{class:!0});var f=y(e);t=b(f,"SPAN",{class:!0,"data-svelte-h":!0}),O(t)!=="svelte-ngl7h5"&&(t.textContent=s),l=S(f),a=b(f,"SPAN",{class:!0});var u=y(a);i=N(u,r),u.forEach(_),f.forEach(_),this.h()},h(){p(t,"class","text-xs text-base-content/50"),p(a,"class","text-sm font-mono ml-2"),p(e,"class","bg-base-300 rounded px-3 py-2 mb-3")},m(o,f){T(o,e,f),c(e,t),c(e,l),c(e,a),c(a,i)},p(o,f){f&2&&r!==(r=o[1].secret_hint+"")&&q(i,r)},d(o){o&&_(e)}}}function Ae(n){let e,t,s,l,a,r;return{c(){e=g("div"),t=de("svg"),s=de("path"),l=U(),a=g("span"),r=x(n[4]),this.h()},l(i){e=b(i,"DIV",{class:!0});var o=y(e);t=ue(o,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0});var f=y(t);s=ue(f,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),y(s).forEach(_),f.forEach(_),l=S(o),a=b(o,"SPAN",{class:!0});var u=y(a);r=N(u,n[4]),u.forEach(_),o.forEach(_),this.h()},h(){p(s,"stroke-linecap","round"),p(s,"stroke-linejoin","round"),p(s,"stroke-width","2"),p(s,"d","M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"),p(t,"xmlns","http://www.w3.org/2000/svg"),p(t,"class","stroke-current shrink-0 h-6 w-6"),p(t,"fill","none"),p(t,"viewBox","0 0 24 24"),p(a,"class","text-sm"),p(e,"class","alert alert-error mb-3")},m(i,o){T(i,e,o),c(e,t),c(t,s),c(e,l),c(e,a),c(a,r)},p(i,o){o&16&&q(r,i[4])},d(i){i&&_(e)}}}function dt(n){let e,t=n[0]&&ye(n);return{c(){t&&t.c(),e=he()},l(s){t&&t.l(s),e=he()},m(s,l){t&&t.m(s,l),T(s,e,l)},p(s,[l]){s[0]?t?t.p(s,l):(t=ye(s),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:F,o:F,d(s){s&&_(e),t&&t.d(s)}}}function ht(n,e,t){let{archive:s=null}=e,{show:l=!1}=e;const a=Ne();let r="",i=!1,o="";async function f(){if(!s||!r){t(4,o="Password cannot be empty");return}t(3,i=!0),t(4,o="");try{if(!await rt(r,s.secret_hint))throw new Error("Password hint mismatch");je.add(s.secret_hint,r),a("unlock",{archive:s,password:r}),u()}catch(h){console.error("Archive unlock error:",h),t(4,o="Incorrect password"),t(2,r="")}finally{t(3,i=!1)}}function u(){t(0,l=!1),t(2,r=""),t(4,o="")}function v(h){h.key==="Enter"?f():h.key==="Escape"&&u()}function d(){r=this.value,t(2,r)}return n.$$set=h=>{"archive"in h&&t(1,s=h.archive),"show"in h&&t(0,l=h.show)},[l,s,r,i,o,f,u,v,d]}class pt extends ${constructor(e){super(),ee(this,e,ht,dt,Y,{archive:1,show:0})}}function vt(n){let e,t,s,l="Discord Archives",a,r,i,o,f=n[0].totalArchives+"",u,v,d,h,m,w=n[0].uniqueServers+"",k,E,A,C,B,P=n[0].uniqueChannels+"",K,W,Q,M,L;const V=n[2].default,I=qe(V,n,n[1],null);return{c(){e=g("div"),t=g("div"),s=g("h1"),s.textContent=l,a=U(),r=g("div"),i=g("div"),o=x("ðŸ“ "),u=x(f),v=x(" archives"),d=U(),h=g("div"),m=x("ðŸ–¥ï¸ "),k=x(w),E=x(" servers"),A=U(),C=g("div"),B=x("ðŸ’¬ "),K=x(P),W=x(" channels"),Q=U(),M=g("div"),I&&I.c(),this.h()},l(D){e=b(D,"DIV",{class:!0});var j=y(e);t=b(j,"DIV",{class:!0});var J=y(t);s=b(J,"H1",{class:!0,"data-svelte-h":!0}),O(s)!=="svelte-gw5vzq"&&(s.textContent=l),a=S(J),r=b(J,"DIV",{class:!0});var Z=y(r);i=b(Z,"DIV",{});var ae=y(i);o=N(ae,"ðŸ“ "),u=N(ae,f),v=N(ae," archives"),ae.forEach(_),d=S(Z),h=b(Z,"DIV",{});var oe=y(h);m=N(oe,"ðŸ–¥ï¸ "),k=N(oe,w),E=N(oe," servers"),oe.forEach(_),A=S(Z),C=b(Z,"DIV",{});var ie=y(C);B=N(ie,"ðŸ’¬ "),K=N(ie,P),W=N(ie," channels"),ie.forEach(_),Z.forEach(_),J.forEach(_),Q=S(j),M=b(j,"DIV",{class:!0});var we=y(M);I&&I.l(we),we.forEach(_),j.forEach(_),this.h()},h(){p(s,"class","text-xl font-semibold mb-3"),p(r,"class","text-sm space-y-1 text-base-content/70"),p(t,"class","p-5 bg-base-300 border-b border-base-100"),p(M,"class","flex-1 overflow-y-auto p-3"),p(e,"class","w-80 bg-base-200 border-r border-base-300 flex flex-col h-screen")},m(D,j){T(D,e,j),c(e,t),c(t,s),c(t,a),c(t,r),c(r,i),c(i,o),c(i,u),c(i,v),c(r,d),c(r,h),c(h,m),c(h,k),c(h,E),c(r,A),c(r,C),c(C,B),c(C,K),c(C,W),c(e,Q),c(e,M),I&&I.m(M,null),L=!0},p(D,[j]){(!L||j&1)&&f!==(f=D[0].totalArchives+"")&&q(u,f),(!L||j&1)&&w!==(w=D[0].uniqueServers+"")&&q(k,w),(!L||j&1)&&P!==(P=D[0].uniqueChannels+"")&&q(K,P),I&&I.p&&(!L||j&2)&&Oe(I,V,D,D[1],L?Re(V,D[1],j,null):ze(D[1]),null)},i(D){L||(H(I,D),L=!0)},o(D){z(I,D),L=!1},d(D){D&&_(e),I&&I.d(D)}}}function _t(n,e,t){let s;fe(n,et,r=>t(0,s=r));let{$$slots:l={},$$scope:a}=e;return n.$$set=r=>{"$$scope"in r&&t(1,a=r.$$scope)},[s,a,l]}class mt extends ${constructor(e){super(),ee(this,e,_t,vt,Y,{})}}function De(n,e,t){const s=n.slice();return s[6]=e[t],s}function Se(n){let e,t=pe(n[1].channels),s=[];for(let l=0;l<t.length;l+=1)s[l]=Ue(De(n,t,l));return{c(){e=g("div");for(let l=0;l<s.length;l+=1)s[l].c();this.h()},l(l){e=b(l,"DIV",{class:!0});var a=y(e);for(let r=0;r<s.length;r+=1)s[r].l(a);a.forEach(_),this.h()},h(){p(e,"class","pl-3 mt-2 space-y-1")},m(l,a){T(l,e,a);for(let r=0;r<s.length;r+=1)s[r]&&s[r].m(e,null)},p(l,a){if(a&10){t=pe(l[1].channels);let r;for(r=0;r<t.length;r+=1){const i=De(l,t,r);s[r]?s[r].p(i,a):(s[r]=Ue(i),s[r].c(),s[r].m(e,null))}for(;r<s.length;r+=1)s[r].d(1);s.length=t.length}},d(l){l&&_(e),xe(s,l)}}}function Ue(n){let e,t,s="#",l,a,r=(n[6].channel_name||n[6].channel_id)+"",i,o,f,u=new Date(n[6].exported_at).toLocaleDateString()+"",v,d,h,m;function w(){return n[4](n[6])}return{c(){e=g("button"),t=g("span"),t.textContent=s,l=U(),a=g("span"),i=x(r),o=U(),f=g("span"),v=x(u),d=U(),this.h()},l(k){e=b(k,"BUTTON",{class:!0});var E=y(e);t=b(E,"SPAN",{class:!0,"data-svelte-h":!0}),O(t)!=="svelte-ulfyf0"&&(t.textContent=s),l=S(E),a=b(E,"SPAN",{class:!0});var A=y(a);i=N(A,r),A.forEach(_),o=S(E),f=b(E,"SPAN",{class:!0});var C=y(f);v=N(C,u),C.forEach(_),d=S(E),E.forEach(_),this.h()},h(){p(t,"class","text-base-content/50 group-hover:text-base-content"),p(a,"class","flex-1"),p(f,"class","text-xs text-base-content/40"),p(e,"class","w-full px-3 py-2 rounded hover:bg-base-100 transition-colors flex items-center gap-2 text-sm text-left group")},m(k,E){T(k,e,E),c(e,t),c(e,l),c(e,a),c(a,i),c(e,o),c(e,f),c(f,v),c(e,d),h||(m=G(e,"click",w),h=!0)},p(k,E){n=k,E&2&&r!==(r=(n[6].channel_name||n[6].channel_id)+"")&&q(i,r),E&2&&u!==(u=new Date(n[6].exported_at).toLocaleDateString()+"")&&q(v,u)},d(k){k&&_(e),h=!1,m()}}}function bt(n){let e,t,s,l="â–¼",a,r,i=n[1].name+"",o,f,u,v,d=!n[0]&&Se(n);return{c(){e=g("div"),t=g("button"),s=g("span"),s.textContent=l,a=U(),r=g("span"),o=x(i),f=U(),d&&d.c(),this.h()},l(h){e=b(h,"DIV",{class:!0});var m=y(e);t=b(m,"BUTTON",{class:!0});var w=y(t);s=b(w,"SPAN",{class:!0,"data-svelte-h":!0}),O(s)!=="svelte-12dk04l"&&(s.textContent=l),a=S(w),r=b(w,"SPAN",{});var k=y(r);o=N(k,i),k.forEach(_),w.forEach(_),f=S(m),d&&d.l(m),m.forEach(_),this.h()},h(){p(s,"class","transform transition-transform text-xs"),R(s,"rotate-0",!n[0]),R(s,"-rotate-90",n[0]),p(t,"class","w-full px-3 py-2 bg-base-300 rounded hover:bg-base-100 transition-colors flex items-center gap-2 font-semibold text-sm"),p(e,"class","mb-4")},m(h,m){T(h,e,m),c(e,t),c(t,s),c(t,a),c(t,r),c(r,o),c(e,f),d&&d.m(e,null),u||(v=G(t,"click",n[2]),u=!0)},p(h,[m]){m&1&&R(s,"rotate-0",!h[0]),m&1&&R(s,"-rotate-90",h[0]),m&2&&i!==(i=h[1].name+"")&&q(o,i),h[0]?d&&(d.d(1),d=null):d?d.p(h,m):(d=Se(h),d.c(),d.m(e,null))},i:F,o:F,d(h){h&&_(e),d&&d.d(),u=!1,v()}}}function gt(n,e,t){let{server:s}=e,{collapsed:l=!1}=e;const a=Ne();function r(){t(0,l=!l)}function i(f){a("selectChannel",f)}const o=f=>i(f);return n.$$set=f=>{"server"in f&&t(1,s=f.server),"collapsed"in f&&t(0,l=f.collapsed)},[l,s,r,i,o]}class wt extends ${constructor(e){super(),ee(this,e,gt,bt,Y,{server:1,collapsed:0})}}function kt(n){let e,t="Welcome",s,l,a="Select a channel to view";return{c(){e=g("h2"),e.textContent=t,s=U(),l=g("div"),l.textContent=a,this.h()},l(r){e=b(r,"H2",{class:!0,"data-svelte-h":!0}),O(e)!=="svelte-qeexzb"&&(e.textContent=t),s=S(r),l=b(r,"DIV",{class:!0,"data-svelte-h":!0}),O(l)!=="svelte-563yit"&&(l.textContent=a),this.h()},h(){p(e,"class","text-lg font-semibold"),p(l,"class","text-sm text-base-content/60")},m(r,i){T(r,e,i),T(r,s,i),T(r,l,i)},p:F,d(r){r&&(_(e),_(s),_(l))}}}function Et(n){let e,t,s=(n[0].channel_name||n[0].channel_id)+"",l,a,r=n[0].export_path.endsWith(".enc"),i,o,f,u=new Date(n[0].exported_at).toLocaleString()+"",v,d,h=n[0].format.toUpperCase()+"",m,w=r&&Ie();return{c(){e=g("div"),t=g("h2"),l=x(s),a=U(),w&&w.c(),i=U(),o=g("div"),f=x("Latest export: "),v=x(u),d=x(" â€¢ "),m=x(h),this.h()},l(k){e=b(k,"DIV",{class:!0});var E=y(e);t=b(E,"H2",{class:!0});var A=y(t);l=N(A,s),a=S(A),w&&w.l(A),A.forEach(_),E.forEach(_),i=S(k),o=b(k,"DIV",{class:!0});var C=y(o);f=N(C,"Latest export: "),v=N(C,u),d=N(C," â€¢ "),m=N(C,h),C.forEach(_),this.h()},h(){p(t,"class","text-lg font-semibold"),p(e,"class","flex items-center gap-2"),p(o,"class","text-sm text-base-content/60 mt-1")},m(k,E){T(k,e,E),c(e,t),c(t,l),c(t,a),w&&w.m(t,null),T(k,i,E),T(k,o,E),c(o,f),c(o,v),c(o,d),c(o,m)},p(k,E){E&1&&s!==(s=(k[0].channel_name||k[0].channel_id)+"")&&q(l,s),E&1&&(r=k[0].export_path.endsWith(".enc")),r?w||(w=Ie(),w.c(),w.m(t,null)):w&&(w.d(1),w=null),E&1&&u!==(u=new Date(k[0].exported_at).toLocaleString()+"")&&q(v,u),E&1&&h!==(h=k[0].format.toUpperCase()+"")&&q(m,h)},d(k){k&&(_(e),_(i),_(o)),w&&w.d()}}}function Ie(n){let e,t="ðŸ”’";return{c(){e=g("span"),e.textContent=t,this.h()},l(s){e=b(s,"SPAN",{class:!0,"data-svelte-h":!0}),O(e)!=="svelte-1cny2mi"&&(e.textContent=t),this.h()},h(){p(e,"class","ml-2")},m(s,l){T(s,e,l)},d(s){s&&_(e)}}}function yt(n){let e,t='<div class="text-6xl mb-4">ðŸ“–</div> <div class="text-lg">Select a channel from the sidebar to start browsing</div>';return{c(){e=g("div"),e.innerHTML=t,this.h()},l(s){e=b(s,"DIV",{class:!0,"data-svelte-h":!0}),O(e)!=="svelte-54z0r5"&&(e.innerHTML=t),this.h()},h(){p(e,"class","flex flex-col items-center justify-center h-full text-base-content/40")},m(s,l){T(s,e,l)},p:F,d(s){s&&_(e)}}}function Ct(n){let e,t;return{c(){e=g("iframe"),this.h()},l(s){e=b(s,"IFRAME",{src:!0,title:!0,class:!0}),y(e).forEach(_),this.h()},h(){ke(e.src,t=n[1])||p(e,"src",t),p(e,"title","Archive viewer"),p(e,"class","w-full h-full border-0")},m(s,l){T(s,e,l)},p(s,l){l&2&&!ke(e.src,t=s[1])&&p(e,"src",t)},d(s){s&&_(e)}}}function At(n){let e,t='<div class="loading loading-spinner loading-lg"></div>';return{c(){e=g("div"),e.innerHTML=t,this.h()},l(s){e=b(s,"DIV",{class:!0,"data-svelte-h":!0}),O(e)!=="svelte-1nt18fs"&&(e.innerHTML=t),this.h()},h(){p(e,"class","flex items-center justify-center h-full")},m(s,l){T(s,e,l)},p:F,d(s){s&&_(e)}}}function Dt(n){let e,t,s,l;function a(v,d){return v[0]?Et:kt}let r=a(n),i=r(n);function o(v,d){return v[2]?At:v[1]?Ct:yt}let f=o(n),u=f(n);return{c(){e=g("div"),t=g("div"),i.c(),s=U(),l=g("div"),u.c(),this.h()},l(v){e=b(v,"DIV",{class:!0});var d=y(e);t=b(d,"DIV",{class:!0});var h=y(t);i.l(h),h.forEach(_),s=S(d),l=b(d,"DIV",{class:!0});var m=y(l);u.l(m),m.forEach(_),d.forEach(_),this.h()},h(){p(t,"class","p-4 bg-base-200 border-b border-base-300"),p(l,"class","flex-1 overflow-hidden"),p(e,"class","flex-1 flex flex-col bg-base-100")},m(v,d){T(v,e,d),c(e,t),i.m(t,null),c(e,s),c(e,l),u.m(l,null)},p(v,[d]){r===(r=a(v))&&i?i.p(v,d):(i.d(1),i=r(v),i&&(i.c(),i.m(t,null))),f===(f=o(v))&&u?u.p(v,d):(u.d(1),u=f(v),u&&(u.c(),u.m(l,null)))},i:F,o:F,d(v){v&&_(e),i.d(),u.d()}}}function St(n,e,t){let{archive:s=null}=e,{blobUrl:l=null}=e,{isLoading:a=!1}=e;return n.$$set=r=>{"archive"in r&&t(0,s=r.archive),"blobUrl"in r&&t(1,l=r.blobUrl),"isLoading"in r&&t(2,a=r.isLoading)},[s,l,a]}class Ut extends ${constructor(e){super(),ee(this,e,St,Dt,Y,{archive:0,blobUrl:1,isLoading:2})}}function Pe(n,e,t){const s=n.slice();return s[11]=e[t],s}function Le(n){let e,t;return e=new ut({}),{c(){ne(e.$$.fragment)},l(s){re(e.$$.fragment,s)},m(s,l){le(e,s,l),t=!0},i(s){t||(H(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){se(e,s)}}}function Te(n){let e,t,s,l;return e=new mt({props:{$$slots:{default:[It]},$$scope:{ctx:n}}}),s=new Ut({props:{archive:n[0],blobUrl:n[1],isLoading:n[2]}}),{c(){ne(e.$$.fragment),t=U(),ne(s.$$.fragment)},l(a){re(e.$$.fragment,a),t=S(a),re(s.$$.fragment,a)},m(a,r){le(e,a,r),T(a,t,r),le(s,a,r),l=!0},p(a,r){const i={};r&16448&&(i.$$scope={dirty:r,ctx:a}),e.$set(i);const o={};r&1&&(o.archive=a[0]),r&2&&(o.blobUrl=a[1]),r&4&&(o.isLoading=a[2]),s.$set(o)},i(a){l||(H(e.$$.fragment,a),H(s.$$.fragment,a),l=!0)},o(a){z(e.$$.fragment,a),z(s.$$.fragment,a),l=!1},d(a){a&&_(t),se(e,a),se(s,a)}}}function Ve(n){let e,t;return e=new wt({props:{server:n[11]}}),e.$on("selectChannel",n[7]),{c(){ne(e.$$.fragment)},l(s){re(e.$$.fragment,s)},m(s,l){le(e,s,l),t=!0},p(s,l){const a={};l&64&&(a.server=s[11]),e.$set(a)},i(s){t||(H(e.$$.fragment,s),t=!0)},o(s){z(e.$$.fragment,s),t=!1},d(s){se(e,s)}}}function It(n){let e,t,s=pe(n[6]),l=[];for(let r=0;r<s.length;r+=1)l[r]=Ve(Pe(n,s,r));const a=r=>z(l[r],1,1,()=>{l[r]=null});return{c(){for(let r=0;r<l.length;r+=1)l[r].c();e=he()},l(r){for(let i=0;i<l.length;i+=1)l[i].l(r);e=he()},m(r,i){for(let o=0;o<l.length;o+=1)l[o]&&l[o].m(r,i);T(r,e,i),t=!0},p(r,i){if(i&192){s=pe(r[6]);let o;for(o=0;o<s.length;o+=1){const f=Pe(r,s,o);l[o]?(l[o].p(f,i),H(l[o],1)):(l[o]=Ve(f),l[o].c(),H(l[o],1),l[o].m(e.parentNode,e))}for(me(),o=s.length;o<l.length;o+=1)a(o);_e()}},i(r){if(!t){for(let i=0;i<s.length;i+=1)H(l[i]);t=!0}},o(r){l=l.filter(Boolean);for(let i=0;i<l.length;i+=1)z(l[i]);t=!1},d(r){r&&_(e),xe(l,r)}}}function Pt(n){let e,t,s,l,a,r,i,o=!n[5].isUnlocked&&Le();function f(d){n[9](d)}let u={archive:n[4]};n[3]!==void 0&&(u.show=n[3]),l=new pt({props:u}),Fe.push(()=>Ge(l,"show",f)),l.$on("unlock",n[8]);let v=n[5].isUnlocked&&Te(n);return{c(){e=U(),t=g("div"),o&&o.c(),s=U(),ne(l.$$.fragment),r=U(),v&&v.c(),this.h()},l(d){We("svelte-1v5xc6b",document.head).forEach(_),e=S(d),t=b(d,"DIV",{class:!0});var m=y(t);o&&o.l(m),s=S(m),re(l.$$.fragment,m),r=S(m),v&&v.l(m),m.forEach(_),this.h()},h(){document.title="Discord Archive Browser",p(t,"class","flex h-screen overflow-hidden")},m(d,h){T(d,e,h),T(d,t,h),o&&o.m(t,null),c(t,s),le(l,t,null),c(t,r),v&&v.m(t,null),i=!0},p(d,[h]){d[5].isUnlocked?o&&(me(),z(o,1,1,()=>{o=null}),_e()):o?h&32&&H(o,1):(o=Le(),o.c(),H(o,1),o.m(t,s));const m={};h&16&&(m.archive=d[4]),!a&&h&8&&(a=!0,m.show=d[3],Ke(()=>a=!1)),l.$set(m),d[5].isUnlocked?v?(v.p(d,h),h&32&&H(v,1)):(v=Te(d),v.c(),H(v,1),v.m(t,null)):v&&(me(),z(v,1,1,()=>{v=null}),_e())},i(d){i||(H(o),H(l.$$.fragment,d),H(v),i=!0)},o(d){z(o),z(l.$$.fragment,d),z(v),i=!1},d(d){d&&(_(e),_(t)),o&&o.d(),se(l),v&&v.d()}}}function Lt(n,e,t){let s,l;fe(n,X,m=>t(5,s=m)),fe(n,$e,m=>t(6,l=m));let a=null,r=null,i=!1,o=!1,f=null;async function u(m){const w=m.detail;if(t(0,a=w),w.export_path.endsWith(".enc")){const k=je.get(w.secret_hint);k?await d(w,k):(t(4,f=w),t(3,o=!0))}else t(1,r=w.export_path)}async function v(m){const{archive:w,password:k}=m.detail;await d(w,k),t(3,o=!1)}async function d(m,w){t(2,i=!0);try{const k=await ot(m.export_path,w);r&&r.startsWith("blob:")&&URL.revokeObjectURL(r),t(1,r=it(k,m))}catch(k){console.error("Failed to load encrypted archive:",k),alert("Failed to decrypt and load archive. The file may be corrupted.")}finally{t(2,i=!1)}}function h(m){o=m,t(3,o)}return[a,r,i,o,f,s,l,u,v,h]}class xt extends ${constructor(e){super(),ee(this,e,Lt,Pt,Y,{})}}export{xt as component,Nt as universal};
